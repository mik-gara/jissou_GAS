<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›¸è«‡çª“å£ è¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
    <style>
        /* ç°¡å˜ãªãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã¤ã‘ã¾ã™ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        .hidden {
            display: none;
        }
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        .progress-bar-inner {
            height: 10px;
            background-color: #007bff;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .question-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        .options-grid {
            display: grid;
            gap: 1rem;
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            font-size: 1rem;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .option-button:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }
        .result-container {
            margin-bottom: 2rem;
        }
        .result-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .result-card.primary {
            border-left: 5px solid #007bff;
            background-color: #f0f8ff;
        }
        .result-card.secondary {
             background-color: #fafafa;
        }
        .notice {
            margin-top: 1rem;
            font-style: italic;
            color: #555;
        }
        .primary-button, .secondary-button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            text-decoration: none;
            cursor: pointer;
            text-align: center;
        }
        .primary-button {
            background-color: #007bff;
            color: white;
        }
        .secondary-button {
            background-color: #e9ecef;
            color: #333;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        .result-text {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div id="questionSection">
            <!-- è³ªå•ãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>

        <!-- çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
        <div id="resultSection" class="hidden">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2>âœ… ãŠã™ã™ã‚ã®ç›¸è«‡çª“å£</h2>
                <p>ã‚ãªãŸã®çŠ¶æ³ã«æœ€é©ãªçª“å£ã‚’ã”ææ¡ˆã—ã¾ã™</p>
            </div>

            <div class="result-container" id="resultContainer">
                <!-- çµæœãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
            </div>

            <div class="contact-section">
                <h3>ğŸ“ ä»Šã™ãç›¸è«‡ã—ã¦ã¿ã¾ã—ã‚‡ã†</h3>
                <div id="contactButtonContainer">
                    <!-- é€£çµ¡ãƒœã‚¿ãƒ³ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                </div>
            </div>

            <div id="clinicsContainer" class="hidden">
                <h4>åˆ©ç”¨å¯èƒ½ãªåŒ»ç™‚æ©Ÿé–¢ï¼ˆä¾‹ï¼‰</h4>
                <div id="clinicsList">
                    <!-- ã‚¯ãƒªãƒ‹ãƒƒã‚¯æƒ…å ±ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                </div>
            </div>

            <div class="warning-box" style="background-color: #fff3cd; padding: 1rem; border-radius: 8px; margin-top: 2rem;">
                <strong>ã”åˆ©ç”¨å‰ã®æ³¨æ„</strong>
                <p style="margin: 0;">ç·Šæ€¥æ€§ãŒé«˜ã„å ´åˆã‚„ã€æ¨å¥¨ã•ã‚ŒãŸçª“å£ã§å¯¾å¿œãŒå›°é›£ãªå ´åˆã¯ã€
                ä»–ã®å°‚é–€æ©Ÿé–¢ã¸ã®ç´¹ä»‹ã‚‚å—ã‘ã‚‰ã‚Œã¾ã™ã€‚ã¾ãšã¯ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</p>
            </div>

            <div class="action-buttons">
                <button class="secondary-button" id="restartButton">ğŸ”„ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
                <button class="secondary-button" id="showResultTextButton">ğŸ“„ çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã§è¡¨ç¤º</button>
            </div>

            <div id="resultTextContainer" class="hidden">
                <h4>è¨ºæ–­çµæœï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ï¼‰</h4>
                <div class="result-text" id="resultText"></div>
            </div>
        </div>
    </div>


    <script>
    //============== JAVASCRIPT ã“ã“ã‹ã‚‰ ==============
ã€€ã€€ // GASã®Webã‚¢ãƒ—ãƒªURLã‚’è¨­å®šã—ã¦ãã ã•ã„
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyA1sOBWKdieibi4Gk40lD-8cN0h_58AAQ0JUwvqFumPQuwf7hf8R3mL1AJ5H3nrA9j/exec';

     // ï¼‘ï¼ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹
        let appState = {
            currentStep: 0,
            answers: {},
            showResult: false,
            dataSaved: false,
            sessionId: generateSessionId()
        };

  
    // 2. ç›¸è«‡çª“å£ãƒ‡ãƒ¼ã‚¿ (ã‚µãƒ³ãƒ—ãƒ«æƒ…å ±ã‚’å……å®Ÿã•ã›ã¾ã—ãŸ)
    const counselingServices = {
        health_support_24h: {
            name: 'æ•™è·å“¡é›»è©±å¥åº·ç›¸è«‡24',
            serviceType: 'é›»è©±ç›¸è«‡',
            contact: '012-345-0001',
            hours: '24æ™‚é–“365æ—¥',
            features: ['24æ™‚é–“å¯¾å¿œ', 'åŒ¿åOK', 'æ•™è·å“¡å°‚ç”¨'],
            description: 'ã„ã¤ã§ã‚‚è©±ã›ã‚‹å®‰å¿ƒã®24æ™‚é–“å¯¾å¿œçª“å£ã§ã™ã€‚ç·Šæ€¥ã®éš›ã¯ã“ã¡ã‚‰ã«ã”ç›¸è«‡ãã ã•ã„ã€‚'
        },
        medical_chugoku_central: {
            name: 'ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡ï¼ˆä¸­å›½ä¸­å¤®ç—…é™¢ï¼‰',
            serviceType: 'åŒ»ç™‚æ©Ÿé–¢å—è¨º',
            contact: '012-345-0002',
            hours: 'å¹³æ—¥æ˜¼é–“ (è¦äºˆç´„)',
            features: ['å°‚é–€åŒ»å¯¾å¿œ', 'å¯¾é¢ç›¸è«‡', 'æ²»ç™‚é€£æº'],
            description: 'åŒ»å¸«ã«ã‚ˆã‚‹å°‚é–€çš„ãªè¨ºå¯Ÿã‚„ç›¸è«‡ãŒå—ã‘ã‚‰ã‚Œã¾ã™ã€‚'
        },
        female_doctor_phone: {
            name: 'å¥³æ€§åŒ»å¸«é›»è©±ç›¸è«‡',
            serviceType: 'é›»è©±ç›¸è«‡',
            contact: '012-345-0003',
            hours: 'æŒ‡å®šæ—¥æ™‚ (è¦ç¢ºèª)',
            features: ['å¥³æ€§åŒ»å¸«', 'åŒ¿åOK', 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®'],
            description: 'å¥³æ€§ç‰¹æœ‰ã®å¥åº·å•é¡Œã«ã¤ã„ã¦ã€å¥³æ€§åŒ»å¸«ã«é›»è©±ã§ç›¸è«‡ã§ãã¾ã™ã€‚'
        },
        hotline_kokoro: {
            name: 'ã“ã“ã‚ã®æ‚©ã¿ãƒ›ãƒƒãƒˆãƒ©ã‚¤ãƒ³',
            serviceType: 'é›»è©±ç›¸è«‡',
            contact: '012-345-0004',
            hours: 'å¹³æ—¥ 9:00-17:00',
            features: ['ä»•äº‹ã®æ‚©ã¿ç‰¹åŒ–', 'å°‚é–€ç›¸è«‡å“¡'],
            description: 'è·å ´ã®äººé–“é–¢ä¿‚ã‚„æ¥­å‹™ã«é–¢ã™ã‚‹æ‚©ã¿ã«ç‰¹åŒ–ã—ãŸç›¸è«‡çª“å£ã§ã™ã€‚'
        },
        caregiving_support_phone: {
            name: 'ä»‹è­·é›»è©±ç›¸è«‡',
            serviceType: 'é›»è©±ç›¸è«‡',
            contact: '012-345-0005',
            hours: 'å¹³æ—¥ 9:00-17:00',
            features: ['ä»‹è­·å•é¡Œå°‚é–€', 'å®¶æ—ã®æ‚©ã¿'],
            description: 'ã”å®¶æ—ã®ä»‹è­·ãªã©ã€ç§ç”Ÿæ´»ã«é–¢ã™ã‚‹æ‚©ã¿ã‚’å°‚é–€å®¶ã«ç›¸è«‡ã§ãã¾ã™ã€‚'
        },
        health_and_mind_consult: {
            name: 'ã“ã“ã‚ã¨ã‹ã‚‰ã ã®å¥åº·ç›¸è«‡',
            serviceType: 'é›»è©±ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ»å¯¾é¢ç›¸è«‡',
            contact: '012-345-0006',
            hours: 'å¹³æ—¥ 9:00-18:00',
            features: ['ç·åˆç›¸è«‡', 'å¹…åºƒã„å¯¾å¿œ', 'åˆæœŸç›¸è«‡ã«æœ€é©'],
            description: 'å¿ƒã‚„ä½“ã®ä¸èª¿ã€ä»•äº‹ã‚„å®¶åº­ã®å•é¡Œãªã©ã€å¹…åºƒã„æ‚©ã¿ã«å¯¾å¿œã™ã‚‹ç·åˆçª“å£ã§ã™ã€‚'
        },
        mental_health_consult: {
            name: 'é›»è©±ãƒ»é¢è«‡ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡',
            serviceType: 'é›»è©±ãƒ»å¯¾é¢ç›¸è«‡',
            contact: '012-345-0007',
            hours: 'å¹³æ—¥å¤œé–“ãƒ»åœŸæ—¥ã‚‚å¯¾å¿œ (è¦äºˆç´„)',
            features: ['å¤œé–“ä¼‘æ—¥å¯¾å¿œ', 'è‡¨åºŠå¿ƒç†å£«', 'ç¶™ç¶šã‚µãƒãƒ¼ãƒˆ'],
            description: 'å¹³æ—¥å¤œã‚„é€±æœ«ãªã©ã€ã”éƒ½åˆã®è‰¯ã„æ™‚é–“å¸¯ã«å°‚é–€å®¶ã¨ã®ç›¸è«‡ãŒå¯èƒ½ã§ã™ã€‚'
        },
        line_consult: {
            name: 'LINEã‚’ä½¿ã£ãŸãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡',
            serviceType: 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç›¸è«‡',
            contact: 'https://example.com/line',
            hours: 'å¹³æ—¥å¤œé–“ãƒ»åœŸæ—¥ä¸­å¿ƒ',
            features: ['LINEã§æ‰‹è»½ã«', 'è‹¥æ‰‹æ•™å“¡å‘ã‘'],
            description: 'ãƒãƒ£ãƒƒãƒˆå½¢å¼ã§æ°—è»½ã«å°‚é–€å®¶ã«ç›¸è«‡ã§ãã‚‹ã€æ–°ã—ã„å½¢ã®çª“å£ã§ã™ã€‚'
        },
        teacher_support_consult: {
            name: 'æ•™è·å“¡ã‚µãƒãƒ¼ãƒˆç›¸è«‡',
            serviceType: 'å¯¾é¢ç›¸è«‡',
            contact: 'è¦äºˆç´„',
            hours: 'å¹³æ—¥å¤œé–“ä¸­å¿ƒ',
            features: ['å¯¾é¢', 'æ•™è·å“¡ç‰¹åŒ–', 'ã˜ã£ãã‚Šç›¸è«‡'],
            description: 'ä»•äº‹çµ‚ã‚ã‚Šã«ã€è½ã¡ç€ã„ãŸç’°å¢ƒã§å°‚é–€å®¶ã¨å¯¾é¢ã§è©±ã›ã¾ã™ã€‚'
        },
        yorozu_consult: {
            name: 'æ•™è·å“¡ã‚ˆã‚ãšç›¸è«‡',
            serviceType: 'å¯¾é¢ç›¸è«‡',
            contact: 'è¦äºˆç´„',
            hours: 'åœŸæ—¥ä¸­å¿ƒ',
            features: ['ä¼‘æ—¥å¯¾å¿œ', 'å¯¾é¢', 'ä½•ã§ã‚‚ç›¸è«‡'],
            description: 'ä»•äº‹ã‹ã‚‰ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã¾ã§ã€ã‚ã‚‰ã‚†ã‚‹æ‚©ã¿ã‚’ä¼‘æ—¥ã«ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚'
        },
        sc_consult: {
            name: 'ã‚¹ã‚¯ãƒ¼ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ç­‰ã‚’æ´»ç”¨ã—ãŸæ•™è·å“¡ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡',
            serviceType: 'å¯¾é¢ç›¸è«‡',
            contact: 'å„å­¦æ ¡ã®SCã«ç¢ºèª',
            hours: 'å¹³æ—¥æ˜¼é–“',
            features: ['èº«è¿‘ãªå°‚é–€å®¶', 'å­¦æ ¡å†…ã§ã®ç›¸è«‡'],
            description: 'å‹¤å‹™æ ¡ã®ã‚¹ã‚¯ãƒ¼ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ãªã©ã€èº«è¿‘ãªå°‚é–€å®¶ã«ç›¸è«‡ã§ãã¾ã™ã€‚'
        },
        stress_consult: {
            name: 'æ•™è·å“¡ã‚¹ãƒˆãƒ¬ã‚¹ç›¸è«‡',
            serviceType: 'å¯¾é¢ç›¸è«‡',
            contact: 'è¦äºˆç´„',
            hours: 'å¹³æ—¥æ˜¼é–“',
            features: ['ã‚¹ãƒˆãƒ¬ã‚¹å°‚é–€', 'å¯¾é¢'],
            description: 'ã‚¹ãƒˆãƒ¬ã‚¹ã®åŸå› åˆ†æã‚„å¯¾å‡¦æ³•ã«ã¤ã„ã¦ã€å°‚é–€å®¶ã¨å¯¾é¢ã§ç›¸è«‡ã—ã¾ã™ã€‚'
        },
        web_consult: {
            name: 'Webç›¸è«‡ï¼ˆã“ã“ã‚ã®ç›¸è«‡ï¼‰',
            serviceType: 'ãƒ¡ãƒ¼ãƒ«ç›¸è«‡',
            contact: 'https://example.com/webform',
            hours: '24æ™‚é–“å—ä»˜',
            features: ['è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§', 'æ–‡ç« ã§æ•´ç†'],
            description: 'æ–‡ç« ã§ã˜ã£ãã‚Šè€ƒãˆã‚’ã¾ã¨ã‚ã¦ç›¸è«‡ã—ãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™ã€‚'
        },
        support_group: {
            name: 'æ•™è·å“¡ã‚’æ”¯ãˆã‚‹ä¼š',
            serviceType: 'ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•',
            contact: 'æœˆ1å›é–‹å‚¬',
            hours: 'åœŸæ—¥ä¸­å¿ƒ',
            features: ['ä»²é–“ã¨ã®äº¤æµ', 'ãƒ”ã‚¢ã‚µãƒãƒ¼ãƒˆ'],
            description: 'åŒã˜ç«‹å ´ã®ä»²é–“ã¨æ‚©ã¿ã‚’åˆ†ã‹ã¡åˆã„ã€æ”¯ãˆåˆã†ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•ã§ã™ã€‚'
        },
        encounter_group: {
            name: 'ã‚¨ãƒ³ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ä½“é¨“è¬›åº§',
            serviceType: 'ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•',
            contact: 'å®šæœŸé–‹å‚¬',
            hours: 'åœŸæ—¥ä¸­å¿ƒ',
            features: ['å¯¾äººé–¢ä¿‚ã‚¹ã‚­ãƒ«å‘ä¸Š', 'ä½“é¨“å­¦ç¿’'],
            description: 'ã‚°ãƒ«ãƒ¼ãƒ—ã§ã®å¯¾è©±ã‚’é€šã˜ã¦ã€è‡ªå·±ç†è§£ã‚„ä»–è€…ç†è§£ã‚’æ·±ã‚ã¾ã™ã€‚'
        }
    };

    // 3. è³ªå•ãƒ‡ãƒ¼ã‚¿
    const questions = [
        { id: 'urgency', question: 'ä»Šã®ã‚ãªãŸã®çŠ¶æ³ã¯ï¼Ÿ', options: [ { value: 'emergency', label: 'ğŸš¨ å³æ™‚å¯¾å¿œã—ã¦ã»ã—ã„' }, { value: 'urgent', label: 'âš¡ æ•°æ—¥ä¸­ã«ç›¸è«‡ã—ãŸã„' }, { value: 'slowly', label: 'ğŸ• æ€¥ãŒãªã„ãŒæ”¯æ´ã«ç¹‹ãŒã‚ŠãŸã„' } ] },
        { id: 'symptoms', question: 'ä¸»ãªç›¸è«‡å†…å®¹ã¯ä½•ã§ã™ã‹ï¼Ÿ', options: [ { value: 'mental', label: 'ğŸ˜Ÿ æ°—åˆ†ã®è½ã¡è¾¼ã¿ãƒ»ä¸å®‰ãªã©ç²¾ç¥çš„ãªã‚‚ã®' }, { value: 'physical', label: 'ğŸ˜´ é ­ç—›ãƒ»ç–²åŠ´ãªã©èº«ä½“çš„ãªã‚‚ã®' }, { value: 'workplace', label: 'ğŸ’¼ ä»•äº‹ã«é–¢ã™ã‚‹æ‚©ã¿' }, { value: 'private', label: 'ğŸ  ç§ç”Ÿæ´»ã«é–¢ã™ã‚‹æ‚©ã¿' } ] },
        { id: 'preference', question: 'ç›¸è«‡æ–¹æ³•ã®å¸Œæœ›ã¯ï¼Ÿ', options: [ { value: 'phone', label: 'ğŸ“ é›»è©±ã§ç›¸è«‡ã—ãŸã„' }, { value: 'online', label: 'ğŸ’» ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚„ãƒ¡ãƒ¼ãƒ«ã§ç›¸è«‡ã—ãŸã„' }, { value: 'face', label: 'ğŸ‘¥ å¯¾é¢ã§ã˜ã£ãã‚Šè©±ã—ãŸã„' }, { value: 'medical', label: 'ğŸ¥ åŒ»å¸«ã®è¨ºå¯Ÿã‚’å—ã‘ãŸã„' } ] },
        { id: 'timing', question: 'ç›¸è«‡å¯èƒ½ãªæ™‚é–“å¸¯ã¯ï¼Ÿ', options: [ { value: 'anytime', label: 'ğŸŒ™ ã„ã¤ã§ã‚‚ï¼ˆ24æ™‚é–“å¯¾å¿œå¸Œæœ›ï¼‰' }, { value: 'business', label: 'ğŸŒ… å¹³æ—¥ã®æ—¥ä¸­' }, { value: 'evening', label: 'ğŸŒ† å¹³æ—¥ã®å¤•æ–¹ãƒ»å¤œé–“' }, { value: 'weekend', label: 'ğŸ“… åœŸæ—¥ãƒ»ç¥æ—¥' } ] }
    ];

    // 3.5ã€€ã‚»ãƒƒã‚·ãƒ§ãƒ³IDç”Ÿæˆ
        function generateSessionId() {
            return Math.random().toString(36).substring(2, 14) + Date.now().toString(36);
        }

    // 4. è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯
    function recommendService(answers) {
        const { urgency, symptoms, preference, timing } = answers;
        const fallbackResult = { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: 'ã”å¸Œæœ›ã«è¿‘ã„ç·åˆç›¸è«‡çª“å£ã‚’ã”æ¡ˆå†…ã—ã¾ã™ã€‚' };
        if (urgency === 'emergency' && timing === 'anytime') return { primary: 'health_support_24h', secondary: [], notice: 'ã”å¸Œæœ›ã«åˆã†24æ™‚é–“å¯¾å¿œã®çª“å£ã§ã™ã€‚' };
        if (preference === 'medical') return { primary: 'medical_chugoku_central', secondary: ['female_doctor_phone'], notice: 'åŒ»å¸«ã«ã‚ˆã‚‹ç›¸è«‡ã«ã¯ã€å¯¾é¢ãŒå¯èƒ½ãªã€Œãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡ï¼ˆä¸­å›½ä¸­å¤®ç—…é™¢ï¼‰ã€ï¼ˆå¹³æ—¥æ˜¼é–“ï¼‰ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚é›»è©±ã§ã®ç›¸è«‡ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€Œå¥³æ€§åŒ»å¸«é›»è©±ç›¸è«‡ã€ã‚‚ã”ã–ã„ã¾ã™ã€‚' };
        if (urgency === 'emergency') {
            if (preference === 'phone') {
                if (symptoms === 'workplace') return { primary: 'hotline_kokoro', secondary: ['mental_health_consult'], notice: 'ä»•äº‹ã®æ‚©ã¿ã«ç‰¹åŒ–ã—ãŸé›»è©±çª“å£ã§ã™ã€‚' };
                if (symptoms === 'private') return { primary: 'caregiving_support_phone', secondary: ['mental_health_consult'], notice: 'ç§ç”Ÿæ´»ã®æ‚©ã¿ã«å¯¾å¿œã™ã‚‹é›»è©±çª“å£ã§ã™ã€‚' };
            }
            if (timing === 'evening' || timing === 'weekend') return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: 'å¤œé–“ãƒ»ä¼‘æ—¥ã‚‚å¯¾å¿œå¯èƒ½ãªç›¸è«‡çª“å£ã§ã™ã€‚' };
            return { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: 'å¹…åºƒã„ç›¸è«‡ã«å¯¾å¿œã§ãã‚‹ç·åˆçª“å£ã§ã™ã€‚' };
        }
        if (urgency === 'urgent') {
            if (preference === 'online' && (timing === 'evening' || timing === 'weekend')) return { primary: 'line_consult', secondary: [], notice: 'LINEã§æ°—è»½ã«ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' };
            if (preference === 'face') {
                if (timing === 'evening') return { primary: 'teacher_support_consult', secondary: ['yorozu_consult'], notice: 'å¹³æ—¥å¤œé–“ã«å¯¾é¢ã§ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' };
                if (timing === 'business' && symptoms === 'workplace') return { primary: 'sc_consult', secondary: ['stress_consult'], notice: 'è·å ´ã§èº«è¿‘ãªå°‚é–€å®¶ã«ç›¸è«‡ã§ãã¾ã™ã€‚' };
                if (timing === 'business') return { primary: 'stress_consult', secondary: ['sc_consult'], notice: 'å¹³æ—¥æ˜¼é–“ã«å¯¾é¢ã§ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' };
            }
            return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: 'é›»è©±ãƒ»å¯¾é¢ã§ç›¸è«‡ã§ãã‚‹æŸ”è»Ÿãªçª“å£ã§ã™ã€‚' };
        }
        if (urgency === 'slowly') {
            if (preference === 'online') return { primary: 'web_consult', secondary: [], notice: 'ã”è‡ªèº«ã®ãƒšãƒ¼ã‚¹ã§ãƒ¡ãƒ¼ãƒ«ã§ç›¸è«‡ã§ãã¾ã™ã€‚' };
            if (preference === 'face') return { primary: 'support_group', secondary: ['encounter_group'], notice: 'åŒã˜ç«‹å ´ã®ä»²é–“ã¨äº¤æµã§ãã‚‹å ´ã§ã™ã€‚' };
        }
        return fallbackResult;
    }

    // 5. çµæœè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯
    function displayResults(result) {
        document.getElementById('questionSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');
        const resultContainer = document.getElementById('resultContainer');
        const contactButtonContainer = document.getElementById('contactButtonContainer');
        resultContainer.innerHTML = ''; contactButtonContainer.innerHTML = '';
        const primaryService = counselingServices[result.primary];
        if (!primaryService) { resultContainer.innerHTML = '<p>ã‚¨ãƒ©ãƒ¼</p>'; return; }
        const primaryHTML = `<div class="result-card primary"><h3>${primaryService.name}</h3><p><strong>ç›¸è«‡å½¢å¼ï¼š</strong> ${primaryService.serviceType || ''}</p><p><strong>å¯¾å¿œæ™‚é–“ï¼š</strong> ${primaryService.hours || ''}</p><p><strong>ç‰¹å¾´ï¼š</strong> ${(primaryService.features || []).join(' / ')}</p><p>${primaryService.description || ''}</p><p class="notice">${result.notice}</p></div>`;
        resultContainer.innerHTML += primaryHTML;
        if (primaryService.contact && primaryService.contact.startsWith('0')) { contactButtonContainer.innerHTML = `<a href="tel:${primaryService.contact}" class="primary-button">ğŸ“ ${primaryService.contact} ã«é›»è©±ã™ã‚‹</a>`; } 
        else if (primaryService.contact) { contactButtonContainer.innerHTML = `<a href="${primaryService.contact}" target="_blank" class="primary-button">å…¬å¼ã‚µã‚¤ãƒˆã¸</a>`; }
        if (result.secondary && result.secondary.length > 0) {
            let secondaryHTML = '<h4>ã“ã¡ã‚‰ã®çª“å£ã‚‚ã”æ¤œè¨ãã ã•ã„</h4>';
            result.secondary.forEach(id => {
                const service = counselingServices[id];
                if(service) secondaryHTML += `<div class="result-card secondary"><h5>${service.name}</h5><p><strong>ç›¸è«‡å½¢å¼ï¼š</strong> ${service.serviceType || ''}</p></div>`;
            });
            resultContainer.innerHTML += secondaryHTML;
        }
        document.getElementById('restartButton').onclick = () => location.reload();
        document.getElementById('showResultTextButton').onclick = () => {
            let text = `ã€ã‚ãªãŸã¸ã®ãŠã™ã™ã‚ã€‘\n${primaryService.name}\nç›¸è«‡å½¢å¼ï¼š${primaryService.serviceType || ''}\né€£çµ¡å…ˆï¼š${primaryService.contact || ''}\n\n${result.notice}\n`;
            document.getElementById('resultText').innerText = text;
            document.getElementById('resultTextContainer').classList.toggle('hidden');
        };
    }

    // 6. è³ªå•è¡¨ç¤ºã¨ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
    function handleOptionClick(value) {
        appState.answers[questions[appState.currentStep].id] = value;
        appState.currentStep++;
        if (appState.currentStep < questions.length) {
            renderQuestion();
        } else {
            const result = recommendService(appState.answers);
            displayResults(result);
        }
    }

    function renderQuestion() {
        const questionData = questions[appState.currentStep];
        const progress = ((appState.currentStep + 1) / questions.length) * 100;
        let html = `
            <div class="progress-bar"><div class="progress-bar-inner" style="width: ${progress}%;"></div></div>
            <p>è³ªå• ${appState.currentStep + 1} / ${questions.length}</p>
            <h2 class="question-title">${questionData.question}</h2>
            <div class="options-grid">
        `;
        questionData.options.forEach(option => {
            html += `<button class="option-button" onclick="handleOptionClick('${option.value}')">${option.label}</button>`;
        });
        html += `</div>`;
        document.getElementById('questionSection').innerHTML = html;
    }
       // GASã«ãƒ‡ãƒ¼ã‚¿é€ä¿¡ï¼ˆãƒ•ã‚©ãƒ¼ãƒ çµŒç”±ã§CORSå›é¿ï¼‰
function saveToGAS(answers, recommendation, clickedContact = false) {
    const now = new Date();
    const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

    const data = {
        sessionId: appState.sessionId,
        timestamp: now.toISOString(),
        date: now.toLocaleDateString('ja-JP'),
        weekday: weekdays[now.getDay()],
        time: now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
        urgency: answers.urgency || '',
        symptoms: answers.symptoms || '',
        preference: answers.preference || '',
        timing: answers.timing || '',
        recommendedService: recommendation.name,
        serviceType: recommendation.serviceType,
        contactClicked: clickedContact ? 'ã¯ã„' : 'ã„ã„ãˆ',
        hour: now.getHours()
    };

    submitFormToGAS(data);
    return true;
}

// ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’åŸ‹ã‚ã¦é€ä¿¡
function submitFormToGAS(data) {
    const form = document.getElementById('gasForm');
    for (const key in data) {
        if (form.elements[key]) {
            form.elements[key].value = data[key];
        }
    }
    form.submit();
}
        
    // 7. ã‚¢ãƒ—ãƒªã®åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', () => {
        renderQuestion();
    });

    </script>
    
<!-- éè¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒ ï¼ˆGASé€ä¿¡ç”¨ï¼‰ -->
<form id="gasForm" action="https://script.google.com/macros/s/AKfycbyA1sOBWKdieibi4Gk40lD-8cN0h_58AAQ0JUwvqFumPQuwf7hf8R3mL1AJ5H3nrA9j/exec" method="POST" target="hiddenFrame" style="display: none;">
  <input type="hidden" name="sessionId">
  <input type="hidden" name="timestamp">
  <input type="hidden" name="date">
  <input type="hidden" name="weekday">
  <input type="hidden" name="time">
  <input type="hidden" name="urgency">
  <input type="hidden" name="symptoms">
  <input type="hidden" name="preference">
  <input type="hidden" name="timing">
  <input type="hidden" name="recommendedService">
  <input type="hidden" name="serviceType">
  <input type="hidden" name="contactClicked">
  <input type="hidden" name="hour">
</form>
<iframe name="hiddenFrame" style="display: none;"></iframe>

</body>
</html>
