<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã“ã‚ã¨ã‹ã‚‰ã ã®å¥åº·ç›¸è«‡çª“å£ææ¡ˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        /* æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã“ã“ã«ãƒšãƒ¼ã‚¹ãƒˆ */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #00bfff 0%, #87cefa 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .main-header { text-align: center; color: #1e40af; padding: 3rem 2rem 2rem; background: linear-gradient(135deg, #f8fafc, #e2e8f0); }
        .main-header h1 { font-size: 2.5rem; margin-bottom: 1rem; font-weight: 700; }
        .main-header p { font-size: 1.2rem; color: #64748b; }
        .content { padding: 2rem; }
        .progress-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .progress-text { font-size: 1rem; color: #64748b; }
        .progress-bar { height: 6px; background-color: #e2e8f0; border-radius: 3px; margin: 1rem 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6, #06b6d4); border-radius: 3px; transition: width 0.5s ease; }
        .question-container { background: linear-gradient(135deg, #f8fafc, #f1f5f9); padding: 2.5rem; border-radius: 15px; margin: 2rem 0; border: 1px solid #e2e8f0; }
        .question-container h3 { font-size: 1.5rem; color: #1e293b; margin-bottom: 2rem; text-align: center; }
        .option-button { width: 100%; padding: 1.5rem; margin: 0.75rem 0; background: white; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; text-align: left; display: flex; align-items: center; gap: 1rem; }
        .option-button:hover { border-color: #3b82f6; background: linear-gradient(135deg, #eff6ff, #dbeafe); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(59, 130, 246, 0.1); }
        .back-button { background: #64748b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; margin-bottom: 1rem; transition: background 0.3s ease; }
        .back-button:hover { background: #475569; }
        .result-container h3 { font-size: 2rem; margin-bottom: 1rem; color: #1e293b; }
        .result-container p { font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9; color: #334155; }
        .result-card { background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 10px 25px rgba(0,0,0,0.07); margin-bottom: 1.5rem; border: 1px solid #e2e8f0; }
        .result-card.primary { border-left: 5px solid #3b82f6; }
        .result-card.secondary { border-left: 5px solid #9ca3af; background: #f8fafc; }
        .feature-tag { background-color: #e0e7ff; color: #4338ca; padding: 0.5rem 1rem; border-radius: 20px; margin: 0.25rem; display: inline-block; font-size: 0.9rem; font-weight: 500;}
        .contact-button { background: linear-gradient(135deg, #f59e0b, #f97316); color: white; padding: 1.2rem 2rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; width: 100%; margin: -0.5rem 0 2.5rem 0; transition: all 0.3s ease; text-decoration: none; display: block; text-align: center; word-break: break-all; /* URLãŒé•·ã„å ´åˆã«å‚™ãˆã¦æ”¹è¡Œã‚’è¨±å¯ */ }
        .contact-button:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(245, 158, 11, 0.3); }
        .clinic-info { background-color: #f1f5f9; padding: 1.5rem; border-radius: 12px; margin: 1rem 0; border-left: 4px solid #3b82f6; }
        .clinic-info strong { display: block; margin-bottom: 0.5rem; color: #1e293b; }
        .warning-box { background: #fef3cd; border: 1px solid #f6e05e; border-radius: 12px; padding: 1.5rem; margin: 2rem 0; color: #92400e; }
        .warning-box strong { display: block; margin-bottom: 0.5rem; }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
        .secondary-button { background: #64748b; color: white; padding: 1rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: background 0.3s ease; }
        .secondary-button:hover { background: #475569; }
        .footer { text-align: center; margin-top: 3rem; padding: 2rem; color: #64748b; font-size: 1rem; line-height: 1.8; }
        .hidden { display: none; }
        @media (max-width: 768px) { body { padding: 10px; } .action-buttons, .result-grid { grid-template-columns: 1fr; } .main-header h1 { font-size: 2rem; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header">
            <h1>ğŸ“‹ ç›¸è«‡çª“å£ææ¡ˆãƒ„ãƒ¼ãƒ«</h1>
            <p>ç°¡å˜ãªè³ªå•ã«ç­”ãˆã¦ã€ã‚ãªãŸã«æœ€é©ãªç›¸è«‡çª“å£ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†</p>
        </div>

        <div class="content">
            <!-- è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="questionSection">
                <div class="progress-container">
                    <span class="progress-text" id="progressText"></span>
                    <span class="progress-text" id="progressPercent"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <button class="back-button hidden" id="backButton">â† å‰ã®è³ªå•ã«æˆ»ã‚‹</button>
                <div class="question-container">
                    <h3 id="questionTitle"></h3>
                    <div id="optionsContainer"></div>
                </div>
            </div>

            <!-- çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="resultSection" class="hidden">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2>âœ… ãŠã™ã™ã‚ã®ç›¸è«‡çª“å£</h2>
                    <p>ã‚ãªãŸã®çŠ¶æ³ã«æœ€é©ãªçª“å£ã‚’ã”ææ¡ˆã—ã¾ã™</p>
                </div>

                <div class="action-buttons">
                    <button class="secondary-button" id="restartButton">ğŸ”„ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</button>
                    <button class="secondary-button" id="showResultTextButton">ğŸ“„ çµæœã‚’ãƒ†ã‚­ã‚¹ãƒˆã§ã‚³ãƒ”ãƒ¼</button>
                </div>
                
                <div id="resultContainer"></div>

                <div id="clinicsContainer" class="hidden">
                    <h4>åˆ©ç”¨å¯èƒ½ãªåŒ»ç™‚æ©Ÿé–¢ï¼ˆä¾‹ï¼‰</h4>
                    <div id="clinicsList"></div>
                </div>

                <div class="warning-box">
                    <strong>ã”åˆ©ç”¨å‰ã®æ³¨æ„</strong>
                    <p style="margin: 0;">ç·Šæ€¥æ€§ãŒé«˜ã„å ´åˆã‚„ã€æ¨å¥¨ã•ã‚ŒãŸçª“å£ã§å¯¾å¿œãŒå›°é›£ãªå ´åˆã¯ã€ä»–ã®å°‚é–€æ©Ÿé–¢ã¸ã®ç´¹ä»‹ã‚‚å—ã‘ã‚‰ã‚Œã¾ã™ã€‚ã¾ãšã¯ãŠæ°—è»½ã«ã”ç›¸è«‡ãã ã•ã„ã€‚</p>
                </div>
            </div>

            <div class="footer">
                ğŸ’¡ ã™ã¹ã¦ã®ç›¸è«‡ã¯ç§˜å¯†ãŒå®ˆã‚‰ã‚Œã¾ã™ã€‚ç›¸è«‡ã¯å‹‡æ°—ã®ã„ã‚‹ã“ã¨ã§ã™ãŒã€å°‚é–€å®¶ãŒã‚ãªãŸã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚ä¸€äººã§æŠ±ãˆè¾¼ã¾ãšã€ã¾ãšã¯æ°—è»½ã«ã”é€£çµ¡ãã ã•ã„ã€‚
            </div>
        </div>
    </div>

    <script>
    //============== JAVASCRIPT ã“ã“ã‹ã‚‰ ==============

    // --- çŠ¶æ…‹ç®¡ç† ---
    let appState = {
        currentStep: 0,
        answers: {},
        dataSaved: false,
        sessionId: generateSessionId()
    };

    // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---

    // ç›¸è«‡çª“å£ãƒ‡ãƒ¼ã‚¿
    const counselingServices = {
        health_support_24h: { name: 'æ•™è·å“¡é›»è©±å¥åº·ç›¸è«‡24', 
                             serviceType: 'é›»è©±ç›¸è«‡',
                             contact: 'https://www.okayamafukurinet.jp/data/52/health_page/', 
                             hours: '24æ™‚é–“ã€€å¹´ä¸­ç„¡ä¼‘', 
                             features: ['24æ™‚é–“', 'ä¿å¥å¸«å¯¾å¿œ', 'ç„¡æ–™','å›æ•°åˆ¶é™ãªã—'], 
                             description: 'å…±æ¸ˆæœ¬éƒ¨ãŒé–‹è¨­ã™ã‚‹24æ™‚é–“çª“å£ã§ã™ã€‚ãƒã‚¤ãƒšãƒ¼ã‚¸å†…ã§é›»è©±ç•ªå·ã‚’ã”ç¢ºèªãã ã•ã„ã€‚' },
        medical_chugoku_central: { name: 'ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡ï¼ˆä¸­å›½ä¸­å¤®ç—…é™¢ï¼‰',
                                  serviceType: 'åŒ»ç™‚æ©Ÿé–¢å—è¨º', 
                                  contact: '012-345-0002', 
                                  hours: 'å¹³æ—¥æ˜¼é–“ (è¦äºˆç´„)',
                                  features: ['å°‚é–€åŒ»å¯¾å¿œ', 'å¯¾é¢ç›¸è«‡', 'æ²»ç™‚é€£æº'],
                                  description: 'åŒ»å¸«ã«ã‚ˆã‚‹å°‚é–€çš„ãªè¨ºå¯Ÿã‚„ç›¸è«‡ãŒå—ã‘ã‚‰ã‚Œã¾ã™ã€‚' },
        female_doctor_phone: { name: 'å¥³æ€§åŒ»å¸«é›»è©±ç›¸è«‡', 
                              serviceType: 'é›»è©±ç›¸è«‡', 
                              contact: '012-345-0003', 
                              hours: 'æŒ‡å®šæ—¥æ™‚ (è¦ç¢ºèª)', 
                              features: ['å¥³æ€§åŒ»å¸«', 'åŒ¿åOK', 'ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é…æ…®'],
                              description: 'å¥³æ€§ç‰¹æœ‰ã®å¥åº·å•é¡Œã«ã¤ã„ã¦ã€å¥³æ€§åŒ»å¸«ã«é›»è©±ã§ç›¸è«‡ã§ãã¾ã™ã€‚' },
        hotline_kokoro: { name: 'ã“ã“ã‚ã®æ‚©ã¿ãƒ›ãƒƒãƒˆãƒ©ã‚¤ãƒ³',
                         serviceType: 'é›»è©±ç›¸è«‡', 
                         contact: '012-345-0004', 
                         hours: 'å¹³æ—¥ 9:00-17:00', 
                         features: ['ä»•äº‹ã®æ‚©ã¿ç‰¹åŒ–', 'å°‚é–€ç›¸è«‡å“¡'], 
                         description: 'è·å ´ã®äººé–“é–¢ä¿‚ã‚„æ¥­å‹™ã«é–¢ã™ã‚‹æ‚©ã¿ã«ç‰¹åŒ–ã—ãŸç›¸è«‡çª“å£ã§ã™ã€‚' },
        caregiving_support_phone: { name: 'ä»‹è­·é›»è©±ç›¸è«‡', 
                                   serviceType: 'é›»è©±ç›¸è«‡',
                                   contact: '012-345-0005', 
                                   hours: 'å¹³æ—¥ 9:00-17:00', 
                                   features: ['ä»‹è­·å•é¡Œå°‚é–€', 'å®¶æ—ã®æ‚©ã¿'], 
                                   description: 'ã”å®¶æ—ã®ä»‹è­·ãªã©ã€ç§ç”Ÿæ´»ã«é–¢ã™ã‚‹æ‚©ã¿ã‚’å°‚é–€å®¶ã«ç›¸è«‡ã§ãã¾ã™ã€‚' },
        health_and_mind_consult: { name: 'ã“ã“ã‚ã¨ã‹ã‚‰ã ã®å¥åº·ç›¸è«‡', 
                                  serviceType: 'é›»è©±ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ»å¯¾é¢ç›¸è«‡',
                                  contact: '012-345-0006', 
                                  hours: 'å¹³æ—¥ 9:00-18:00', 
                                  features: ['ç·åˆç›¸è«‡', 'å¹…åºƒã„å¯¾å¿œ', 'åˆæœŸç›¸è«‡ã«æœ€é©'], 
                                  description: 'å¿ƒã‚„ä½“ã®ä¸èª¿ã€ä»•äº‹ã‚„å®¶åº­ã®å•é¡Œãªã©ã€å¹…åºƒã„æ‚©ã¿ã«å¯¾å¿œã™ã‚‹ç·åˆçª“å£ã§ã™ã€‚' },
        mental_health_consult: { name: 'é›»è©±ãƒ»é¢è«‡ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡', 
                                serviceType: 'é›»è©±ãƒ»å¯¾é¢ç›¸è«‡', 
                                contact: '012-345-0007', 
                                hours: 'å¹³æ—¥å¤œé–“ãƒ»åœŸæ—¥ã‚‚å¯¾å¿œ (è¦äºˆç´„)', 
                                features: ['å¤œé–“ä¼‘æ—¥å¯¾å¿œ', 'è‡¨åºŠå¿ƒç†å£«', 'ç¶™ç¶šã‚µãƒãƒ¼ãƒˆ'], 
                                description: 'å¹³æ—¥å¤œã‚„é€±æœ«ãªã©ã€ã”éƒ½åˆã®è‰¯ã„æ™‚é–“å¸¯ã«å°‚é–€å®¶ã¨ã®ç›¸è«‡ãŒå¯èƒ½ã§ã™ã€‚' },
        line_consult: { name: 'LINEã‚’ä½¿ã£ãŸãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡', 
                       serviceType: 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ç›¸è«‡', 
                       contact: 'https://example.com/line', 
                       hours: 'å¹³æ—¥å¤œé–“ãƒ»åœŸæ—¥ä¸­å¿ƒ', 
                       features: ['LINEã§æ‰‹è»½ã«', 'è‹¥æ‰‹æ•™å“¡å‘ã‘'], 
                       description: 'ãƒãƒ£ãƒƒãƒˆå½¢å¼ã§æ°—è»½ã«å°‚é–€å®¶ã«ç›¸è«‡ã§ãã‚‹ã€æ–°ã—ã„å½¢ã®çª“å£ã§ã™ã€‚' },
        teacher_support_consult: { name: 'æ•™è·å“¡ã‚µãƒãƒ¼ãƒˆç›¸è«‡', 
                                  serviceType: 'å¯¾é¢ç›¸è«‡', 
                                  contact: 'è¦äºˆç´„', 
                                  hours: 'å¹³æ—¥å¤œé–“ä¸­å¿ƒ', 
                                  features: ['å¯¾é¢', 'æ•™è·å“¡ç‰¹åŒ–', 'ã˜ã£ãã‚Šç›¸è«‡'], 
                                  description: 'ä»•äº‹çµ‚ã‚ã‚Šã«ã€è½ã¡ç€ã„ãŸç’°å¢ƒã§å°‚é–€å®¶ã¨å¯¾é¢ã§è©±ã›ã¾ã™ã€‚' },
        yorozu_consult: { name: 'æ•™è·å“¡ã‚ˆã‚ãšç›¸è«‡', 
                         serviceType: 'å¯¾é¢ç›¸è«‡', 
                         contact: 'è¦äºˆç´„',
                         hours: 'åœŸæ—¥ä¸­å¿ƒ', 
                         features: ['ä¼‘æ—¥å¯¾å¿œ', 'å¯¾é¢', 'ä½•ã§ã‚‚ç›¸è«‡'], 
                         description: 'ä»•äº‹ã‹ã‚‰ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã¾ã§ã€ã‚ã‚‰ã‚†ã‚‹æ‚©ã¿ã‚’ä¼‘æ—¥ã«ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' },
        sc_consult: { name: 'ã‚¹ã‚¯ãƒ¼ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ç­‰ã‚’æ´»ç”¨ã—ãŸæ•™è·å“¡ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡', 
                     serviceType: 'å¯¾é¢ç›¸è«‡', 
                     contact: 'å„å­¦æ ¡ã®SCã«ç¢ºèª', 
                     hours: 'å¹³æ—¥æ˜¼é–“', 
                     features: ['èº«è¿‘ãªå°‚é–€å®¶', 'å­¦æ ¡å†…ã§ã®ç›¸è«‡'], 
                     description: 'å‹¤å‹™æ ¡ã®ã‚¹ã‚¯ãƒ¼ãƒ«ã‚«ã‚¦ãƒ³ã‚»ãƒ©ãƒ¼ãªã©ã€èº«è¿‘ãªå°‚é–€å®¶ã«ç›¸è«‡ã§ãã¾ã™ã€‚' },
        stress_consult: { name: 'æ•™è·å“¡ã‚¹ãƒˆãƒ¬ã‚¹ç›¸è«‡', 
                         serviceType: 'å¯¾é¢ç›¸è«‡', 
                         contact: 'è¦äºˆç´„',
                         hours: 'å¹³æ—¥æ˜¼é–“', 
                         features: ['ã‚¹ãƒˆãƒ¬ã‚¹å°‚é–€', 'å¯¾é¢'], 
                         description: 'ã‚¹ãƒˆãƒ¬ã‚¹ã®åŸå› åˆ†æã‚„å¯¾å‡¦æ³•ã«ã¤ã„ã¦ã€å°‚é–€å®¶ã¨å¯¾é¢ã§ç›¸è«‡ã—ã¾ã™ã€‚' },
        web_consult: { name: 'Webç›¸è«‡ï¼ˆã“ã“ã‚ã®ç›¸è«‡ï¼‰', 
                      serviceType: 'ãƒ¡ãƒ¼ãƒ«ç›¸è«‡', 
                      contact: 'soudan@example.com', 
                      hours: '24æ™‚é–“å—ä»˜', 
                      features: ['è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§', 'æ–‡ç« ã§æ•´ç†', 'ãƒ¡ãƒ¼ãƒ«ç›¸è«‡'], 
                      description: 'æ–‡ç« ã§ã˜ã£ãã‚Šè€ƒãˆã‚’ã¾ã¨ã‚ã¦ç›¸è«‡ã—ãŸã„æ–¹ã«é©ã—ã¦ã„ã¾ã™ã€‚' },
        support_group: { name: 'æ•™è·å“¡ã‚’æ”¯ãˆã‚‹ä¼š', 
                        serviceType: 'ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•',
                        contact: 'æœˆ1å›é–‹å‚¬', 
                        hours: 'åœŸæ—¥ä¸­å¿ƒ', 
                        features: ['ä»²é–“ã¨ã®äº¤æµ', 'ãƒ”ã‚¢ã‚µãƒãƒ¼ãƒˆ'], 
                        description: 'åŒã˜ç«‹å ´ã®ä»²é–“ã¨æ‚©ã¿ã‚’åˆ†ã‹ã¡åˆã„ã€æ”¯ãˆåˆã†ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•ã§ã™ã€‚' },
        encounter_group: { name: 'ã‚¨ãƒ³ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚°ãƒ«ãƒ¼ãƒ—ä½“é¨“è¬›åº§', 
                          serviceType: 'ã‚°ãƒ«ãƒ¼ãƒ—æ´»å‹•', 
                          contact: 'å®šæœŸé–‹å‚¬', 
                          hours: 'åœŸæ—¥ä¸­å¿ƒ', 
                          features: ['å¯¾äººé–¢ä¿‚ã‚¹ã‚­ãƒ«å‘ä¸Š', 'ä½“é¨“å­¦ç¿’'], 
                          description: 'ã‚°ãƒ«ãƒ¼ãƒ—ã§ã®å¯¾è©±ã‚’é€šã˜ã¦ã€è‡ªå·±ç†è§£ã‚„ä»–è€…ç†è§£ã‚’æ·±ã‚ã¾ã™ã€‚' }
    };

    // è³ªå•ãƒ‡ãƒ¼ã‚¿
    const questions = [
        { id: 'urgency', question: 'ä»Šã®ã‚ãªãŸã®çŠ¶æ³ã¯ï¼Ÿ', 
         options: [ { value: 'emergency', label: 'ğŸš¨ ä»Šã™ãè©±ã‚’èã„ã¦ã»ã—ã„' },
                   { value: 'urgent', label: 'âš¡ æ•°æ—¥ä¸­ã«ã¯ç›¸è«‡ã—ãŸã„' },
                   { value: 'slowly', label: 'ğŸ• æ€¥ãŒãªã„ãŒæ”¯æ´ã«ç¹‹ãŒã‚ŠãŸã„' } ] },
        { id: 'symptoms', question: 'ä¸»ãªç›¸è«‡å†…å®¹ã¯ä½•ã§ã™ã‹ï¼Ÿ', 
         options: [ { value: 'mental', label: 'ğŸ˜Ÿ æ°—åˆ†ã®è½ã¡è¾¼ã¿ãƒ»ä¸å®‰ãªã©ã€ã“ã“ã‚ã®ã“ã¨' },
                   { value: 'physical', label: 'ğŸ˜´ é ­ç—›ãƒ»ç–²åŠ´ã‚„çœ ã‚Œãªã„ãªã©ã‹ã‚‰ã ã®ã“ã¨' },
                   { value: 'workplace', label: 'ğŸ’¼ ä»•äº‹ã«é–¢ã™ã‚‹æ‚©ã¿ã€ã‚¹ãƒˆãƒ¬ã‚¹' }, 
                   { value: 'private', label: 'ğŸ  æ—¥å¸¸ç”Ÿæ´»ã‚„å®¶æ—ã«é–¢ã™ã‚‹æ‚©ã¿' } ] },
        { id: 'preference', question: 'ç›¸è«‡æ–¹æ³•ã®å¸Œæœ›ã¯ï¼Ÿ', 
         options: [ { value: 'phone', label: 'ğŸ“ é›»è©±ã§ç›¸è«‡ã—ãŸã„' }, 
ã€€ã€€                { value: 'face', label: 'ğŸ‘¥ å¯¾é¢ã§ã˜ã£ãã‚Šè©±ã—ãŸã„' },
                   { value: 'online', label: 'ğŸ’» ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚„ãƒ¡ãƒ¼ãƒ«ã§ç›¸è«‡ã—ãŸã„' }, 
                   { value: 'medical', label: 'ğŸ¥ åŒ»å¸«ã®è¨ºå¯Ÿã‚’å—ã‘ãŸã„' } ] },
        { id: 'timing', question: 'ç›¸è«‡å¯èƒ½ãªæ™‚é–“å¸¯ã¯ï¼Ÿ', 
         options: [ { value: 'anytime', label: 'ğŸŒ™ 24æ™‚é–“å¯¾å¿œå¸Œæœ›' }, 
                   { value: 'business', label: 'ğŸŒ… å¹³æ—¥ã®æ—¥ä¸­' },
                   { value: 'evening', label: 'ğŸŒ† å¹³æ—¥ã®å¤•æ–¹ãƒ»å¤œé–“' },
                   { value: 'weekend', label: 'ğŸ“… é€±ä¼‘æ—¥' } ] }
    ];

    // --- è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ ---
    function recommendService(answers) {
        const { urgency, symptoms, preference, timing } = answers;
        const fallbackResult = { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: 'ã”å¸Œæœ›ã«è¿‘ã„ç·åˆç›¸è«‡çª“å£ã‚’ã”æ¡ˆå†…ã—ã¾ã™ã€‚' };
        if (urgency === 'emergency' && timing === 'anytime') return { primary: 'health_support_24h', secondary: [], notice: 'ã”å¸Œæœ›ã«åˆã†24æ™‚é–“å¯¾å¿œã®çª“å£ã§ã™ã€‚' };
        if (preference === 'medical') return { primary: 'medical_chugoku_central', secondary: ['female_doctor_phone'], notice: 'åŒ»å¸«ã«ã‚ˆã‚‹ç›¸è«‡ã«ã¯ã€å¯¾é¢ãŒå¯èƒ½ãªã€Œãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹ç›¸è«‡ï¼ˆä¸­å›½ä¸­å¤®ç—…é™¢ï¼‰ã€ï¼ˆå¹³æ—¥æ˜¼é–“ï¼‰ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚é›»è©±ã§ã®ç›¸è«‡ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€Œå¥³æ€§åŒ»å¸«é›»è©±ç›¸è«‡ã€ã‚‚ã”ã–ã„ã¾ã™ã€‚' };
        if (urgency === 'emergency') {
            if (preference === 'phone') {
                if (symptoms === 'workplace') return { primary: 'hotline_kokoro', secondary: ['mental_health_consult'], notice: 'ä»•äº‹ã®æ‚©ã¿ã«ç‰¹åŒ–ã—ãŸé›»è©±çª“å£ã§ã™ã€‚' };
                if (symptoms === 'private') return { primary: 'caregiving_support_phone', secondary: ['mental_health_consult'], notice: 'æ—¥å¸¸ç”Ÿæ´»ã‚„å®¶æ—ã®æ‚©ã¿ã«å¯¾å¿œã™ã‚‹é›»è©±çª“å£ã§ã™ã€‚' };
            }
            if (timing === 'evening' || timing === 'weekend') return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: 'å¤œé–“ãƒ»é€±ä¼‘æ—¥ã‚‚å¯¾å¿œå¯èƒ½ãªç›¸è«‡çª“å£ã§ã™ã€‚' };
            return { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: 'å¹…åºƒã„ç›¸è«‡ã«å¯¾å¿œã§ãã‚‹ç·åˆçª“å£ã§ã™ã€‚' };
        }
        if (urgency === 'urgent') {
            if (preference === 'online' && (timing === 'evening' || timing === 'weekend')) return { primary: 'line_consult', secondary: ['web_consult'], notice: 'LINEã§æ°—è»½ã«ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' };
            if (preference === 'face') {
                if (timing === 'evening') return { primary: 'teacher_support_consult', secondary: ['yorozu_consult'], notice: 'å¹³æ—¥å¤œé–“ã«å¯¾é¢ã§ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' };
                if (timing === 'business' && symptoms === 'workplace') return { primary: 'sc_consult', secondary: ['stress_consult'], notice: 'è·å ´ã§èº«è¿‘ãªå°‚é–€å®¶ã«ç›¸è«‡ã§ãã¾ã™ã€‚' };
                if (timing === 'business') return { primary: 'stress_consult', secondary: ['sc_consult'], notice: 'å¹³æ—¥æ˜¼é–“ã«å¯¾é¢ã§ç›¸è«‡ã§ãã‚‹çª“å£ã§ã™ã€‚' };
            }
            return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: 'é›»è©±ãƒ»å¯¾é¢ã§ç›¸è«‡ã§ãã‚‹æŸ”è»Ÿãªçª“å£ã§ã™ã€‚' };
        }
        if (urgency === 'slowly') {
            if (preference === 'online') return { primary: 'web_consult', secondary: [], notice: 'ã”è‡ªèº«ã®ãƒšãƒ¼ã‚¹ã§ãƒ¡ãƒ¼ãƒ«ã§ç›¸è«‡ã§ãã¾ã™ã€‚' };
            if (preference === 'face') return { primary: 'support_group', secondary: ['encounter_group'], notice: 'åŒã˜ç«‹å ´ã®ä»²é–“ã¨äº¤æµã§ãã‚‹å ´ã§ã™ã€‚' };
        }
        return fallbackResult;
    }

    // --- GASé€£æº ---
    function generateSessionId() { return Math.random().toString(36).substring(2, 14) + Date.now().toString(36); }
    function saveToGAS(answers, recommendation, clickedContact = false) {
        const now = new Date();
        const weekdays = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        const data = { sessionId: appState.sessionId, timestamp: now.toISOString(), date: now.toLocaleDateString('ja-JP'), weekday: weekdays[now.getDay()], time: now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }), urgency: answers.urgency || '', symptoms: answers.symptoms || '', preference: answers.preference || '', timing: answers.timing || '', recommendedService: recommendation.name, serviceType: recommendation.serviceType, contactClicked: clickedContact ? 'ã¯ã„' : 'ã„ã„ãˆ', hour: now.getHours() };
        submitFormToGAS(data);
    }
    function submitFormToGAS(data) {
        const form = document.getElementById('gasForm');
        if (!form) return;
        for (const key in data) { if (form.elements[key]) { form.elements[key].value = data[key]; } }
        form.submit();
    }

     // --- UIåˆ¶å¾¡ ---
    function updateProgress() {
        const progress = (appState.currentStep + 1) / questions.length;
        const progressPercent = Math.round(progress * 100);
        document.getElementById('progressText').textContent = `è³ªå• ${appState.currentStep + 1} / ${questions.length}`;
        document.getElementById('progressPercent').textContent = `${progressPercent}% å®Œäº†`;
        document.getElementById('progressFill').style.width = `${progressPercent}%`;
    }

    function displayQuestion() {
        updateProgress();
        const question = questions[appState.currentStep];
        document.getElementById('questionTitle').textContent = question.question;
        const optionsContainer = document.getElementById('optionsContainer');
        optionsContainer.innerHTML = '';
        question.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-button';
            button.textContent = option.label;
            button.onclick = () => selectOption(option.value);
            optionsContainer.appendChild(button);
        });
        document.getElementById('backButton').classList.toggle('hidden', appState.currentStep === 0);
    }

    function selectOption(value) {
        appState.answers[questions[appState.currentStep].id] = value;
        if (appState.currentStep < questions.length - 1) {
            appState.currentStep++;
            displayQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        const result = recommendService(appState.answers);
        const primaryService = counselingServices[result.primary];
        if (!appState.dataSaved) { saveToGAS(appState.answers, primaryService); appState.dataSaved = true; }
        
        document.getElementById('questionSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');

        const resultContainer = document.getElementById('resultContainer');
        resultContainer.innerHTML = '';
        if (!primaryService) { resultContainer.innerHTML = '<p>ã‚¨ãƒ©ãƒ¼</p>'; return; }

        const createServiceCard = (service, typeClass, notice = '') => {
            let cardHTML = `<div class="result-card ${typeClass}"><h3>${service.name}</h3><p style="margin-bottom: 1rem;">${service.description}</p>`;
            cardHTML += `<div style="margin-bottom: 1rem;">${(service.features || []).map(f => `<span class="feature-tag">${f}</span>`).join('')}</div>`;
            cardHTML += `<p style="font-size: 0.9rem; margin: 0.5rem 0;"><strong>ç›¸è«‡å½¢å¼:</strong> ${service.serviceType || ''}</p>`;
            cardHTML += `<p style="font-size: 0.9rem; margin: 0.5rem 0;"><strong>å¯¾å¿œæ™‚é–“:</strong> ${service.hours || ''}</p>`;
            if (notice) cardHTML += `<p style="font-size: 0.9rem; margin-top: 1rem; color: #555; font-style: italic;">${notice}</p>`;
            cardHTML += `</div>`;
            return cardHTML;
        };

        const createContactButton = (service) => {
            if (!service || !service.contact) return '';
            let href = '', buttonText = '', icon = '', type = 'link';
            
            if (service.contact.includes('@')) {
                href = `mailto:${service.contact}`;
                buttonText = 'ãƒ¡ãƒ¼ãƒ«ã§ç›¸è«‡ã™ã‚‹';
                icon = 'âœ‰ï¸';
            } else if (service.contact.match(/^[0-9\-]+$/)) {
                href = `tel:${service.contact}`;
                buttonText = `ã«é›»è©±ã™ã‚‹`;
                icon = 'ğŸ“ ' + service.contact;
            } else if (service.contact.startsWith('http')) {
                href = service.contact;
                buttonText = service.contact; // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’URLãã®ã‚‚ã®ã«å¤‰æ›´
                icon = 'ğŸŒ';
            } else {
                href = '#';
                buttonText = 'é€£çµ¡æ–¹æ³•ã‚’ç¢ºèª';
                icon = 'ğŸ“';
                type = 'other';
            }
            return `<a href="${href}" class="contact-button" onclick="handleContact(event, '${service.contact}', '${type}', '${service.name}')" ${href.startsWith('http') ? 'target="_blank"' : ''}>${icon} ${buttonText}</a>`;
        }

        resultContainer.innerHTML += createServiceCard(primaryService, 'primary', result.notice);
        resultContainer.innerHTML += createContactButton(primaryService);
        
        if (result.secondary && result.secondary.length > 0) {
            let secondaryHTML = '<h4 style="margin-top: 2.5rem; color: #1e293b; border-top: 1px solid #e2e8f0; padding-top: 2rem;">ã“ã¡ã‚‰ã®çª“å£ã‚‚ã”æ¤œè¨ãã ã•ã„</h4>';
            result.secondary.forEach(id => {
                const service = counselingServices[id];
                if (service) {
                    secondaryHTML += createServiceCard(service, 'secondary');
                    secondaryHTML += createContactButton(service);
                }
            });
            resultContainer.innerHTML += secondaryHTML;
        }
    }
    
    function handleContact(event, contact, type, serviceName) {
        const tempRecommendation = { name: serviceName };
        saveToGAS(appState.answers, tempRecommendation, true);
        if (type === 'other') { event.preventDefault(); alert(`é€£çµ¡æ–¹æ³•: ${contact}`); }
    }

    function initApp() {
        displayQuestion();
        document.getElementById('backButton').onclick = () => { if (appState.currentStep > 0) { appState.currentStep--; displayQuestion(); } };
        document.getElementById('restartButton').onclick = () => location.reload();
        
        document.getElementById('showResultTextButton').onclick = () => {
            const result = recommendService(appState.answers);
            const primaryService = counselingServices[result.primary];
            let text = `ã€ã‚ãªãŸã¸ã®ãŠã™ã™ã‚ã€‘\nâ–  ${primaryService.name}\nç›¸è«‡å½¢å¼: ${primaryService.serviceType || ''}\nå¯¾å¿œæ™‚é–“: ${primaryService.hours || ''}\né€£çµ¡å…ˆ: ${primaryService.contact || ''}\nç‰¹å¾´: ${primaryService.features.join(', ')}\n\n`;
            if (result.secondary && result.secondary.length > 0) {
                text += `ã€ãã®ä»–ã®å€™è£œã€‘\n`;
                result.secondary.forEach(id => { const service = counselingServices[id]; if (service) text += `â–  ${service.name}\n`; });
            }
            navigator.clipboard.writeText(text).then(() => { alert('è¨ºæ–­çµæœã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼'); }).catch(err => { console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err); alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); });
        };
    }

    // --- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ ---
    document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <!-- éè¡¨ç¤ºãƒ•ã‚©ãƒ¼ãƒ ï¼ˆGASé€ä¿¡ç”¨ï¼‰ -->
    <form id="gasForm" action="ã€ã“ã“ã«ã‚ãªãŸã®GASã®Webã‚¢ãƒ—ãƒªURLã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‘" method="POST" target="hiddenFrame" style="display: none;">
        <input type="hidden" name="sessionId"><input type="hidden" name="timestamp"><input type="hidden" name="date"><input type="hidden" name="weekday"><input type="hidden" name="time"><input type="hidden" name="urgency"><input type="hidden" name="symptoms"><input type="hidden" name="preference"><input type="hidden" name="timing"><input type="hidden" name="recommendedService"><input type="hidden" name="serviceType"><input type="hidden" name="contactClicked"><input type="hidden" name="hour">
    </form>
    <iframe name="hiddenFrame" style="display: none;"></iframe>
    
</body>
</html> 
