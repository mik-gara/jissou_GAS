<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>こころとからだの健康相談窓口提案ツール</title>
    <style>
        /* 添付ファイルのデザインをここにペースト */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: linear-gradient(135deg, #00bfff 0%, #87cefa 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .main-header { text-align: center; color: #1e40af; padding: 3rem 2rem 2rem; background: linear-gradient(135deg, #f8fafc, #e2e8f0); }
        .main-header h1 { font-size: 2.5rem; margin-bottom: 1rem; font-weight: 700; }
        .main-header p { font-size: 1.2rem; color: #64748b; }
        .content { padding: 2rem; }
        .progress-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .progress-text { font-size: 1rem; color: #64748b; }
        .progress-bar { height: 6px; background-color: #e2e8f0; border-radius: 3px; margin: 1rem 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6, #06b6d4); border-radius: 3px; transition: width 0.5s ease; }
        .question-container { background: linear-gradient(135deg, #f8fafc, #f1f5f9); padding: 2.5rem; border-radius: 15px; margin: 2rem 0; border: 1px solid #e2e8f0; }
        .question-container h3 { font-size: 1.5rem; color: #1e293b; margin-bottom: 2rem; text-align: center; }
        .option-button { width: 100%; padding: 1.5rem; margin: 0.75rem 0; background: white; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; text-align: left; display: flex; align-items: center; gap: 1rem; }
        .option-button:hover { border-color: #3b82f6; background: linear-gradient(135deg, #eff6ff, #dbeafe); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(59, 130, 246, 0.1); }
        .back-button { background: #64748b; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; margin-bottom: 1rem; transition: background 0.3s ease; }
        .back-button:hover { background: #475569; }
        .result-container h3 { font-size: 2rem; margin-bottom: 1rem; color: #1e293b; }
        .result-container p { font-size: 1.1rem; margin-bottom: 2rem; opacity: 0.9; color: #334155; }
        .result-card { background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 10px 25px rgba(0,0,0,0.07); margin-bottom: 1.5rem; border: 1px solid #e2e8f0; }
        .result-card.primary { border-left: 5px solid #3b82f6; }
        .result-card.secondary { border-left: 5px solid #9ca3af; background: #f8fafc; }
        .feature-tag { background-color: #e0e7ff; color: #4338ca; padding: 0.5rem 1rem; border-radius: 20px; margin: 0.25rem; display: inline-block; font-size: 0.9rem; font-weight: 500;}
        .contact-button { background: linear-gradient(135deg, #f59e0b, #f97316); color: white; padding: 1.2rem 2rem; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; width: 100%; margin: -0.5rem 0 2.5rem 0; transition: all 0.3s ease; text-decoration: none; display: block; text-align: center; word-break: break-all; /* URLが長い場合に備えて改行を許可 */ }
        .contact-button:hover { transform: translateY(-3px); box-shadow: 0 15px 30px rgba(245, 158, 11, 0.3); }
        .clinic-info { background-color: #f1f5f9; padding: 1.5rem; border-radius: 12px; margin: 1rem 0; border-left: 4px solid #3b82f6; }
        .clinic-info strong { display: block; margin-bottom: 0.5rem; color: #1e293b; }
        .warning-box { background: #fef3cd; border: 1px solid #f6e05e; border-radius: 12px; padding: 1.5rem; margin: 2rem 0; color: #92400e; }
        .warning-box strong { display: block; margin-bottom: 0.5rem; }
        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem; }
        .secondary-button { background: #64748b; color: white; padding: 1rem 1.5rem; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: background 0.3s ease; }
        .secondary-button:hover { background: #475569; }
        .footer { text-align: center; margin-top: 3rem; padding: 2rem; color: #64748b; font-size: 1rem; line-height: 1.8; }
        .hidden { display: none; }
        @media (max-width: 768px) { body { padding: 10px; } .action-buttons, .result-grid { grid-template-columns: 1fr; } .main-header h1 { font-size: 2rem; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-header">
            <h1>📋 相談窓口提案ツール</h1>
            <p>簡単な質問に答えて、あなたに最適な相談窓口を見つけましょう</p>
        </div>

        <div class="content">
            <!-- 質問セクション -->
            <div id="questionSection">
                <div class="progress-container">
                    <span class="progress-text" id="progressText"></span>
                    <span class="progress-text" id="progressPercent"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <button class="back-button hidden" id="backButton">← 前の質問に戻る</button>
                <div class="question-container">
                    <h3 id="questionTitle"></h3>
                    <div id="optionsContainer"></div>
                </div>
            </div>

            <!-- 結果セクション -->
            <div id="resultSection" class="hidden">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2>✅ おすすめの相談窓口</h2>
                    <p>あなたの状況に最適な窓口をご提案します</p>
                </div>

                <div class="action-buttons">
                    <button class="secondary-button" id="restartButton">🔄 もう一度診断する</button>
                    <button class="secondary-button" id="showResultTextButton">📄 結果をテキストでコピー</button>
                </div>
                
                <div id="resultContainer"></div>

                <div id="clinicsContainer" class="hidden">
                    <h4>利用可能な医療機関（例）</h4>
                    <div id="clinicsList"></div>
                </div>

                <div class="warning-box">
                    <strong>ご利用前の注意</strong>
                    <p style="margin: 0;">緊急性が高い場合や、推奨された窓口で対応が困難な場合は、他の専門機関への紹介も受けられます。まずはお気軽にご相談ください。</p>
                </div>
            </div>

            <div class="footer">
                💡 すべての相談は秘密が守られます。相談は勇気のいることですが、専門家があなたをサポートします。一人で抱え込まず、まずは気軽にご連絡ください。
            </div>
        </div>
    </div>

    <script>
    //============== JAVASCRIPT ここから ==============

    // --- 状態管理 ---
    let appState = {
        currentStep: 0,
        answers: {},
        dataSaved: false,
        sessionId: generateSessionId()
    };

    // --- データ定義 ---

    // 相談窓口データ
    const counselingServices = {
        health_support_24h: { name: '教職員電話健康相談24', 
                             serviceType: '電話相談',
                             contact: 'https://www.okayamafukurinet.jp/data/52/health_page/', 
                             hours: '24時間　年中無休', 
                             features: ['24時間', '保健師対応', '無料','回数制限なし'], 
                             description: '共済本部が開設する24時間窓口です。マイページ内で電話番号をご確認ください。' },
        medical_chugoku_central: { name: 'メンタルヘルス相談（中国中央病院）',
                                  serviceType: '医療機関受診', 
                                  contact: '012-345-0002', 
                                  hours: '平日昼間 (要予約)',
                                  features: ['専門医対応', '対面相談', '治療連携'],
                                  description: '医師による専門的な診察や相談が受けられます。' },
        female_doctor_phone: { name: '女性医師電話相談', 
                              serviceType: '電話相談', 
                              contact: '012-345-0003', 
                              hours: '指定日時 (要確認)', 
                              features: ['女性医師', '匿名OK', 'プライバシー配慮'],
                              description: '女性特有の健康問題について、女性医師に電話で相談できます。' },
        hotline_kokoro: { name: 'こころの悩みホットライン',
                         serviceType: '電話相談', 
                         contact: '012-345-0004', 
                         hours: '平日 9:00-17:00', 
                         features: ['仕事の悩み特化', '専門相談員'], 
                         description: '職場の人間関係や業務に関する悩みに特化した相談窓口です。' },
        caregiving_support_phone: { name: '介護電話相談', 
                                   serviceType: '電話相談',
                                   contact: '012-345-0005', 
                                   hours: '平日 9:00-17:00', 
                                   features: ['介護問題専門', '家族の悩み'], 
                                   description: 'ご家族の介護など、私生活に関する悩みを専門家に相談できます。' },
        health_and_mind_consult: { name: 'こころとからだの健康相談', 
                                  serviceType: '電話・オンライン・対面相談',
                                  contact: '012-345-0006', 
                                  hours: '平日 9:00-18:00', 
                                  features: ['総合相談', '幅広い対応', '初期相談に最適'], 
                                  description: '心や体の不調、仕事や家庭の問題など、幅広い悩みに対応する総合窓口です。' },
        mental_health_consult: { name: '電話・面談メンタルヘルス相談', 
                                serviceType: '電話・対面相談', 
                                contact: '012-345-0007', 
                                hours: '平日夜間・土日も対応 (要予約)', 
                                features: ['夜間休日対応', '臨床心理士', '継続サポート'], 
                                description: '平日夜や週末など、ご都合の良い時間帯に専門家との相談が可能です。' },
        line_consult: { name: 'LINEを使ったメンタルヘルス相談', 
                       serviceType: 'オンライン相談', 
                       contact: 'https://example.com/line', 
                       hours: '平日夜間・土日中心', 
                       features: ['LINEで手軽に', '若手教員向け'], 
                       description: 'チャット形式で気軽に専門家に相談できる、新しい形の窓口です。' },
        teacher_support_consult: { name: '教職員サポート相談', 
                                  serviceType: '対面相談', 
                                  contact: '要予約', 
                                  hours: '平日夜間中心', 
                                  features: ['対面', '教職員特化', 'じっくり相談'], 
                                  description: '仕事終わりに、落ち着いた環境で専門家と対面で話せます。' },
        yorozu_consult: { name: '教職員よろず相談', 
                         serviceType: '対面相談', 
                         contact: '要予約',
                         hours: '土日中心', 
                         features: ['休日対応', '対面', '何でも相談'], 
                         description: '仕事からプライベートまで、あらゆる悩みを休日に相談できる窓口です。' },
        sc_consult: { name: 'スクールカウンセラー等を活用した教職員メンタルヘルス相談', 
                     serviceType: '対面相談', 
                     contact: '各学校のSCに確認', 
                     hours: '平日昼間', 
                     features: ['身近な専門家', '学校内での相談'], 
                     description: '勤務校のスクールカウンセラーなど、身近な専門家に相談できます。' },
        stress_consult: { name: '教職員ストレス相談', 
                         serviceType: '対面相談', 
                         contact: '要予約',
                         hours: '平日昼間', 
                         features: ['ストレス専門', '対面'], 
                         description: 'ストレスの原因分析や対処法について、専門家と対面で相談します。' },
        web_consult: { name: 'Web相談（こころの相談）', 
                      serviceType: 'メール相談', 
                      contact: 'soudan@example.com', 
                      hours: '24時間受付', 
                      features: ['自分のペースで', '文章で整理', 'メール相談'], 
                      description: '文章でじっくり考えをまとめて相談したい方に適しています。' },
        support_group: { name: '教職員を支える会', 
                        serviceType: 'グループ活動',
                        contact: '月1回開催', 
                        hours: '土日中心', 
                        features: ['仲間との交流', 'ピアサポート'], 
                        description: '同じ立場の仲間と悩みを分かち合い、支え合うグループ活動です。' },
        encounter_group: { name: 'エンカウンターグループ体験講座', 
                          serviceType: 'グループ活動', 
                          contact: '定期開催', 
                          hours: '土日中心', 
                          features: ['対人関係スキル向上', '体験学習'], 
                          description: 'グループでの対話を通じて、自己理解や他者理解を深めます。' }
    };

    // 質問データ
    const questions = [
        { id: 'urgency', question: '今のあなたの状況は？', 
         options: [ { value: 'emergency', label: '🚨 今すぐ話を聞いてほしい' },
                   { value: 'urgent', label: '⚡ 数日中には相談したい' },
                   { value: 'slowly', label: '🕐 急がないが支援に繋がりたい' } ] },
        { id: 'symptoms', question: '主な相談内容は何ですか？', 
         options: [ { value: 'mental', label: '😟 気分の落ち込み・不安など、こころのこと' },
                   { value: 'physical', label: '😴 頭痛・疲労や眠れないなどからだのこと' },
                   { value: 'workplace', label: '💼 仕事に関する悩み、ストレス' }, 
                   { value: 'private', label: '🏠 日常生活や家族に関する悩み' } ] },
        { id: 'preference', question: '相談方法の希望は？', 
         options: [ { value: 'phone', label: '📞 電話で相談したい' }, 
　　                { value: 'face', label: '👥 対面でじっくり話したい' },
                   { value: 'online', label: '💻 オンラインやメールで相談したい' }, 
                   { value: 'medical', label: '🏥 医師の診察を受けたい' } ] },
        { id: 'timing', question: '相談可能な時間帯は？', 
         options: [ { value: 'anytime', label: '🌙 24時間対応希望' }, 
                   { value: 'business', label: '🌅 平日の日中' },
                   { value: 'evening', label: '🌆 平日の夕方・夜間' },
                   { value: 'weekend', label: '📅 週休日' } ] }
    ];

    // --- 診断ロジック ---
    function recommendService(answers) {
        const { urgency, symptoms, preference, timing } = answers;
        const fallbackResult = { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: 'ご希望に近い総合相談窓口をご案内します。' };
        if (urgency === 'emergency' && timing === 'anytime') return { primary: 'health_support_24h', secondary: [], notice: 'ご希望に合う24時間対応の窓口です。' };
        if (preference === 'medical') return { primary: 'medical_chugoku_central', secondary: ['female_doctor_phone'], notice: '医師による相談には、対面が可能な「メンタルヘルス相談（中国中央病院）」（平日昼間）をお勧めします。電話での相談をご希望の場合は「女性医師電話相談」もございます。' };
        if (urgency === 'emergency') {
            if (preference === 'phone') {
                if (symptoms === 'workplace') return { primary: 'hotline_kokoro', secondary: ['mental_health_consult'], notice: '仕事の悩みに特化した電話窓口です。' };
                if (symptoms === 'private') return { primary: 'caregiving_support_phone', secondary: ['mental_health_consult'], notice: '日常生活や家族の悩みに対応する電話窓口です。' };
            }
            if (timing === 'evening' || timing === 'weekend') return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: '夜間・週休日も対応可能な相談窓口です。' };
            return { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: '幅広い相談に対応できる総合窓口です。' };
        }
        if (urgency === 'urgent') {
            if (preference === 'online' && (timing === 'evening' || timing === 'weekend')) return { primary: 'line_consult', secondary: ['web_consult'], notice: 'LINEで気軽に相談できる窓口です。' };
            if (preference === 'face') {
                if (timing === 'evening') return { primary: 'teacher_support_consult', secondary: ['yorozu_consult'], notice: '平日夜間に対面で相談できる窓口です。' };
                if (timing === 'business' && symptoms === 'workplace') return { primary: 'sc_consult', secondary: ['stress_consult'], notice: '職場で身近な専門家に相談できます。' };
                if (timing === 'business') return { primary: 'stress_consult', secondary: ['sc_consult'], notice: '平日昼間に対面で相談できる窓口です。' };
            }
            return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: '電話・対面で相談できる柔軟な窓口です。' };
        }
        if (urgency === 'slowly') {
            if (preference === 'online') return { primary: 'web_consult', secondary: [], notice: 'ご自身のペースでメールで相談できます。' };
            if (preference === 'face') return { primary: 'support_group', secondary: ['encounter_group'], notice: '同じ立場の仲間と交流できる場です。' };
        }
        return fallbackResult;
    }

    // --- GAS連携 ---
    function generateSessionId() { return Math.random().toString(36).substring(2, 14) + Date.now().toString(36); }
    function saveToGAS(answers, recommendation, clickedContact = false) {
        const now = new Date();
        const weekdays = ['日', '月', '火', '水', '木', '金', '土'];
        const data = { sessionId: appState.sessionId, timestamp: now.toISOString(), date: now.toLocaleDateString('ja-JP'), weekday: weekdays[now.getDay()], time: now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }), urgency: answers.urgency || '', symptoms: answers.symptoms || '', preference: answers.preference || '', timing: answers.timing || '', recommendedService: recommendation.name, serviceType: recommendation.serviceType, contactClicked: clickedContact ? 'はい' : 'いいえ', hour: now.getHours() };
        submitFormToGAS(data);
    }
    function submitFormToGAS(data) {
        const form = document.getElementById('gasForm');
        if (!form) return;
        for (const key in data) { if (form.elements[key]) { form.elements[key].value = data[key]; } }
        form.submit();
    }

     // --- UI制御 ---
    function updateProgress() {
        const progress = (appState.currentStep + 1) / questions.length;
        const progressPercent = Math.round(progress * 100);
        document.getElementById('progressText').textContent = `質問 ${appState.currentStep + 1} / ${questions.length}`;
        document.getElementById('progressPercent').textContent = `${progressPercent}% 完了`;
        document.getElementById('progressFill').style.width = `${progressPercent}%`;
    }

    function displayQuestion() {
        updateProgress();
        const question = questions[appState.currentStep];
        document.getElementById('questionTitle').textContent = question.question;
        const optionsContainer = document.getElementById('optionsContainer');
        optionsContainer.innerHTML = '';
        question.options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-button';
            button.textContent = option.label;
            button.onclick = () => selectOption(option.value);
            optionsContainer.appendChild(button);
        });
        document.getElementById('backButton').classList.toggle('hidden', appState.currentStep === 0);
    }

    function selectOption(value) {
        appState.answers[questions[appState.currentStep].id] = value;
        if (appState.currentStep < questions.length - 1) {
            appState.currentStep++;
            displayQuestion();
        } else {
            showResult();
        }
    }

    function showResult() {
        const result = recommendService(appState.answers);
        const primaryService = counselingServices[result.primary];
        if (!appState.dataSaved) { saveToGAS(appState.answers, primaryService); appState.dataSaved = true; }
        
        document.getElementById('questionSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');

        const resultContainer = document.getElementById('resultContainer');
        resultContainer.innerHTML = '';
        if (!primaryService) { resultContainer.innerHTML = '<p>エラー</p>'; return; }

        const createServiceCard = (service, typeClass, notice = '') => {
            let cardHTML = `<div class="result-card ${typeClass}"><h3>${service.name}</h3><p style="margin-bottom: 1rem;">${service.description}</p>`;
            cardHTML += `<div style="margin-bottom: 1rem;">${(service.features || []).map(f => `<span class="feature-tag">${f}</span>`).join('')}</div>`;
            cardHTML += `<p style="font-size: 0.9rem; margin: 0.5rem 0;"><strong>相談形式:</strong> ${service.serviceType || ''}</p>`;
            cardHTML += `<p style="font-size: 0.9rem; margin: 0.5rem 0;"><strong>対応時間:</strong> ${service.hours || ''}</p>`;
            if (notice) cardHTML += `<p style="font-size: 0.9rem; margin-top: 1rem; color: #555; font-style: italic;">${notice}</p>`;
            cardHTML += `</div>`;
            return cardHTML;
        };

        const createContactButton = (service) => {
            if (!service || !service.contact) return '';
            let href = '', buttonText = '', icon = '', type = 'link';
            
            if (service.contact.includes('@')) {
                href = `mailto:${service.contact}`;
                buttonText = 'メールで相談する';
                icon = '✉️';
            } else if (service.contact.match(/^[0-9\-]+$/)) {
                href = `tel:${service.contact}`;
                buttonText = `に電話する`;
                icon = '📞 ' + service.contact;
            } else if (service.contact.startsWith('http')) {
                href = service.contact;
                buttonText = service.contact; // ボタンのテキストをURLそのものに変更
                icon = '🌐';
            } else {
                href = '#';
                buttonText = '連絡方法を確認';
                icon = '📝';
                type = 'other';
            }
            return `<a href="${href}" class="contact-button" onclick="handleContact(event, '${service.contact}', '${type}', '${service.name}')" ${href.startsWith('http') ? 'target="_blank"' : ''}>${icon} ${buttonText}</a>`;
        }

        resultContainer.innerHTML += createServiceCard(primaryService, 'primary', result.notice);
        resultContainer.innerHTML += createContactButton(primaryService);
        
        if (result.secondary && result.secondary.length > 0) {
            let secondaryHTML = '<h4 style="margin-top: 2.5rem; color: #1e293b; border-top: 1px solid #e2e8f0; padding-top: 2rem;">こちらの窓口もご検討ください</h4>';
            result.secondary.forEach(id => {
                const service = counselingServices[id];
                if (service) {
                    secondaryHTML += createServiceCard(service, 'secondary');
                    secondaryHTML += createContactButton(service);
                }
            });
            resultContainer.innerHTML += secondaryHTML;
        }
    }
    
    function handleContact(event, contact, type, serviceName) {
        const tempRecommendation = { name: serviceName };
        saveToGAS(appState.answers, tempRecommendation, true);
        if (type === 'other') { event.preventDefault(); alert(`連絡方法: ${contact}`); }
    }

    function initApp() {
        displayQuestion();
        document.getElementById('backButton').onclick = () => { if (appState.currentStep > 0) { appState.currentStep--; displayQuestion(); } };
        document.getElementById('restartButton').onclick = () => location.reload();
        
        document.getElementById('showResultTextButton').onclick = () => {
            const result = recommendService(appState.answers);
            const primaryService = counselingServices[result.primary];
            let text = `【あなたへのおすすめ】\n■ ${primaryService.name}\n相談形式: ${primaryService.serviceType || ''}\n対応時間: ${primaryService.hours || ''}\n連絡先: ${primaryService.contact || ''}\n特徴: ${primaryService.features.join(', ')}\n\n`;
            if (result.secondary && result.secondary.length > 0) {
                text += `【その他の候補】\n`;
                result.secondary.forEach(id => { const service = counselingServices[id]; if (service) text += `■ ${service.name}\n`; });
            }
            navigator.clipboard.writeText(text).then(() => { alert('診断結果をクリップボードにコピーしました！'); }).catch(err => { console.error('コピー失敗:', err); alert('コピーに失敗しました。'); });
        };
    }

    // --- アプリケーション開始 ---
    document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <!-- 非表示フォーム（GAS送信用） -->
    <form id="gasForm" action="【ここにあなたのGASのWebアプリURLを貼り付けてください】" method="POST" target="hiddenFrame" style="display: none;">
        <input type="hidden" name="sessionId"><input type="hidden" name="timestamp"><input type="hidden" name="date"><input type="hidden" name="weekday"><input type="hidden" name="time"><input type="hidden" name="urgency"><input type="hidden" name="symptoms"><input type="hidden" name="preference"><input type="hidden" name="timing"><input type="hidden" name="recommendedService"><input type="hidden" name="serviceType"><input type="hidden" name="contactClicked"><input type="hidden" name="hour">
    </form>
    <iframe name="hiddenFrame" style="display: none;"></iframe>
    
</body>
</html> 
