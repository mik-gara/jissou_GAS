<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>相談窓口 診断ツール</title>
    <style>
        /* 簡単なデザインをつけます */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f9;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        .hidden {
            display: none;
        }
        .progress-bar {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        .progress-bar-inner {
            height: 10px;
            background-color: #007bff;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .question-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        .options-grid {
            display: grid;
            gap: 1rem;
        }
        .option-button {
            display: block;
            width: 100%;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            font-size: 1rem;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .option-button:hover {
            background-color: #f0f8ff;
            border-color: #007bff;
        }
        .result-container {
            margin-bottom: 2rem;
        }
        .result-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        .result-card.primary {
            border-left: 5px solid #007bff;
            background-color: #f0f8ff;
        }
        .result-card.secondary {
             background-color: #fafafa;
        }
        .notice {
            margin-top: 1rem;
            font-style: italic;
            color: #555;
        }
        .primary-button, .secondary-button {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            text-decoration: none;
            cursor: pointer;
            text-align: center;
        }
        .primary-button {
            background-color: #007bff;
            color: white;
        }
        .secondary-button {
            background-color: #e9ecef;
            color: #333;
        }
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        .result-text {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- 質問セクション -->
        <div id="questionSection">
            <!-- 質問がここに動的に表示されます -->
        </div>

        <!-- 結果セクション（最初は非表示） -->
        <div id="resultSection" class="hidden">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2>✅ おすすめの相談窓口</h2>
                <p>あなたの状況に最適な窓口をご提案します</p>
            </div>

            <div class="result-container" id="resultContainer">
                <!-- 結果がここに動的に追加される -->
            </div>

            <div class="contact-section">
                <h3>📞 今すぐ相談してみましょう</h3>
                <div id="contactButtonContainer">
                    <!-- 連絡ボタンがここに追加される -->
                </div>
            </div>

            <div id="clinicsContainer" class="hidden">
                <h4>利用可能な医療機関（例）</h4>
                <div id="clinicsList">
                    <!-- クリニック情報がここに追加される -->
                </div>
            </div>

            <div class="warning-box" style="background-color: #fff3cd; padding: 1rem; border-radius: 8px; margin-top: 2rem;">
                <strong>ご利用前の注意</strong>
                <p style="margin: 0;">緊急性が高い場合や、推奨された窓口で対応が困難な場合は、
                他の専門機関への紹介も受けられます。まずはお気軽にご相談ください。</p>
            </div>

            <div class="action-buttons">
                <button class="secondary-button" id="restartButton">🔄 もう一度診断する</button>
                <button class="secondary-button" id="showResultTextButton">📄 結果をテキストで表示</button>
            </div>

            <div id="resultTextContainer" class="hidden">
                <h4>診断結果（コピーして保存してください）</h4>
                <div class="result-text" id="resultText"></div>
            </div>
        </div>
    </div>


    <script>
    //============== JAVASCRIPT ここから ==============
　　 // GASのWebアプリURLを設定してください
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyA1sOBWKdieibi4Gk40lD-8cN0h_58AAQ0JUwvqFumPQuwf7hf8R3mL1AJ5H3nrA9j/exec';

     // １．アプリケーションの状態
        let appState = {
            currentStep: 0,
            answers: {},
            showResult: false,
            dataSaved: false,
            sessionId: generateSessionId()
        };

  
    // 2. 相談窓口データ (サンプル情報を充実させました)
    const counselingServices = {
        health_support_24h: {
            name: '教職員電話健康相談24',
            serviceType: '電話相談',
            contact: '012-345-0001',
            hours: '24時間365日',
            features: ['24時間対応', '匿名OK', '教職員専用'],
            description: 'いつでも話せる安心の24時間対応窓口です。緊急の際はこちらにご相談ください。'
        },
        medical_chugoku_central: {
            name: 'メンタルヘルス相談（中国中央病院）',
            serviceType: '医療機関受診',
            contact: '012-345-0002',
            hours: '平日昼間 (要予約)',
            features: ['専門医対応', '対面相談', '治療連携'],
            description: '医師による専門的な診察や相談が受けられます。'
        },
        female_doctor_phone: {
            name: '女性医師電話相談',
            serviceType: '電話相談',
            contact: '012-345-0003',
            hours: '指定日時 (要確認)',
            features: ['女性医師', '匿名OK', 'プライバシー配慮'],
            description: '女性特有の健康問題について、女性医師に電話で相談できます。'
        },
        hotline_kokoro: {
            name: 'こころの悩みホットライン',
            serviceType: '電話相談',
            contact: '012-345-0004',
            hours: '平日 9:00-17:00',
            features: ['仕事の悩み特化', '専門相談員'],
            description: '職場の人間関係や業務に関する悩みに特化した相談窓口です。'
        },
        caregiving_support_phone: {
            name: '介護電話相談',
            serviceType: '電話相談',
            contact: '012-345-0005',
            hours: '平日 9:00-17:00',
            features: ['介護問題専門', '家族の悩み'],
            description: 'ご家族の介護など、私生活に関する悩みを専門家に相談できます。'
        },
        health_and_mind_consult: {
            name: 'こころとからだの健康相談',
            serviceType: '電話・オンライン・対面相談',
            contact: '012-345-0006',
            hours: '平日 9:00-18:00',
            features: ['総合相談', '幅広い対応', '初期相談に最適'],
            description: '心や体の不調、仕事や家庭の問題など、幅広い悩みに対応する総合窓口です。'
        },
        mental_health_consult: {
            name: '電話・面談メンタルヘルス相談',
            serviceType: '電話・対面相談',
            contact: '012-345-0007',
            hours: '平日夜間・土日も対応 (要予約)',
            features: ['夜間休日対応', '臨床心理士', '継続サポート'],
            description: '平日夜や週末など、ご都合の良い時間帯に専門家との相談が可能です。'
        },
        line_consult: {
            name: 'LINEを使ったメンタルヘルス相談',
            serviceType: 'オンライン相談',
            contact: 'https://example.com/line',
            hours: '平日夜間・土日中心',
            features: ['LINEで手軽に', '若手教員向け'],
            description: 'チャット形式で気軽に専門家に相談できる、新しい形の窓口です。'
        },
        teacher_support_consult: {
            name: '教職員サポート相談',
            serviceType: '対面相談',
            contact: '要予約',
            hours: '平日夜間中心',
            features: ['対面', '教職員特化', 'じっくり相談'],
            description: '仕事終わりに、落ち着いた環境で専門家と対面で話せます。'
        },
        yorozu_consult: {
            name: '教職員よろず相談',
            serviceType: '対面相談',
            contact: '要予約',
            hours: '土日中心',
            features: ['休日対応', '対面', '何でも相談'],
            description: '仕事からプライベートまで、あらゆる悩みを休日に相談できる窓口です。'
        },
        sc_consult: {
            name: 'スクールカウンセラー等を活用した教職員メンタルヘルス相談',
            serviceType: '対面相談',
            contact: '各学校のSCに確認',
            hours: '平日昼間',
            features: ['身近な専門家', '学校内での相談'],
            description: '勤務校のスクールカウンセラーなど、身近な専門家に相談できます。'
        },
        stress_consult: {
            name: '教職員ストレス相談',
            serviceType: '対面相談',
            contact: '要予約',
            hours: '平日昼間',
            features: ['ストレス専門', '対面'],
            description: 'ストレスの原因分析や対処法について、専門家と対面で相談します。'
        },
        web_consult: {
            name: 'Web相談（こころの相談）',
            serviceType: 'メール相談',
            contact: 'https://example.com/webform',
            hours: '24時間受付',
            features: ['自分のペースで', '文章で整理'],
            description: '文章でじっくり考えをまとめて相談したい方に適しています。'
        },
        support_group: {
            name: '教職員を支える会',
            serviceType: 'グループ活動',
            contact: '月1回開催',
            hours: '土日中心',
            features: ['仲間との交流', 'ピアサポート'],
            description: '同じ立場の仲間と悩みを分かち合い、支え合うグループ活動です。'
        },
        encounter_group: {
            name: 'エンカウンターグループ体験講座',
            serviceType: 'グループ活動',
            contact: '定期開催',
            hours: '土日中心',
            features: ['対人関係スキル向上', '体験学習'],
            description: 'グループでの対話を通じて、自己理解や他者理解を深めます。'
        }
    };

    // 3. 質問データ
    const questions = [
        { id: 'urgency', question: '今のあなたの状況は？', options: [ { value: 'emergency', label: '🚨 即時対応してほしい' }, { value: 'urgent', label: '⚡ 数日中に相談したい' }, { value: 'slowly', label: '🕐 急がないが支援に繋がりたい' } ] },
        { id: 'symptoms', question: '主な相談内容は何ですか？', options: [ { value: 'mental', label: '😟 気分の落ち込み・不安など精神的なもの' }, { value: 'physical', label: '😴 頭痛・疲労など身体的なもの' }, { value: 'workplace', label: '💼 仕事に関する悩み' }, { value: 'private', label: '🏠 私生活に関する悩み' } ] },
        { id: 'preference', question: '相談方法の希望は？', options: [ { value: 'phone', label: '📞 電話で相談したい' }, { value: 'online', label: '💻 オンラインやメールで相談したい' }, { value: 'face', label: '👥 対面でじっくり話したい' }, { value: 'medical', label: '🏥 医師の診察を受けたい' } ] },
        { id: 'timing', question: '相談可能な時間帯は？', options: [ { value: 'anytime', label: '🌙 いつでも（24時間対応希望）' }, { value: 'business', label: '🌅 平日の日中' }, { value: 'evening', label: '🌆 平日の夕方・夜間' }, { value: 'weekend', label: '📅 土日・祝日' } ] }
    ];

    // 3.5　セッションID生成
        function generateSessionId() {
            return Math.random().toString(36).substring(2, 14) + Date.now().toString(36);
        }

    // 4. 診断ロジック
    function recommendService(answers) {
        const { urgency, symptoms, preference, timing } = answers;
        const fallbackResult = { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: 'ご希望に近い総合相談窓口をご案内します。' };
        if (urgency === 'emergency' && timing === 'anytime') return { primary: 'health_support_24h', secondary: [], notice: 'ご希望に合う24時間対応の窓口です。' };
        if (preference === 'medical') return { primary: 'medical_chugoku_central', secondary: ['female_doctor_phone'], notice: '医師による相談には、対面が可能な「メンタルヘルス相談（中国中央病院）」（平日昼間）をお勧めします。電話での相談をご希望の場合は「女性医師電話相談」もございます。' };
        if (urgency === 'emergency') {
            if (preference === 'phone') {
                if (symptoms === 'workplace') return { primary: 'hotline_kokoro', secondary: ['mental_health_consult'], notice: '仕事の悩みに特化した電話窓口です。' };
                if (symptoms === 'private') return { primary: 'caregiving_support_phone', secondary: ['mental_health_consult'], notice: '私生活の悩みに対応する電話窓口です。' };
            }
            if (timing === 'evening' || timing === 'weekend') return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: '夜間・休日も対応可能な相談窓口です。' };
            return { primary: 'health_and_mind_consult', secondary: ['mental_health_consult'], notice: '幅広い相談に対応できる総合窓口です。' };
        }
        if (urgency === 'urgent') {
            if (preference === 'online' && (timing === 'evening' || timing === 'weekend')) return { primary: 'line_consult', secondary: [], notice: 'LINEで気軽に相談できる窓口です。' };
            if (preference === 'face') {
                if (timing === 'evening') return { primary: 'teacher_support_consult', secondary: ['yorozu_consult'], notice: '平日夜間に対面で相談できる窓口です。' };
                if (timing === 'business' && symptoms === 'workplace') return { primary: 'sc_consult', secondary: ['stress_consult'], notice: '職場で身近な専門家に相談できます。' };
                if (timing === 'business') return { primary: 'stress_consult', secondary: ['sc_consult'], notice: '平日昼間に対面で相談できる窓口です。' };
            }
            return { primary: 'mental_health_consult', secondary: ['health_and_mind_consult'], notice: '電話・対面で相談できる柔軟な窓口です。' };
        }
        if (urgency === 'slowly') {
            if (preference === 'online') return { primary: 'web_consult', secondary: [], notice: 'ご自身のペースでメールで相談できます。' };
            if (preference === 'face') return { primary: 'support_group', secondary: ['encounter_group'], notice: '同じ立場の仲間と交流できる場です。' };
        }
        return fallbackResult;
    }

    // 5. 結果表示ロジック
    function displayResults(result) {
        document.getElementById('questionSection').classList.add('hidden');
        document.getElementById('resultSection').classList.remove('hidden');
        const resultContainer = document.getElementById('resultContainer');
        const contactButtonContainer = document.getElementById('contactButtonContainer');
        resultContainer.innerHTML = ''; contactButtonContainer.innerHTML = '';
        const primaryService = counselingServices[result.primary];
        if (!primaryService) { resultContainer.innerHTML = '<p>エラー</p>'; return; }
        const primaryHTML = `<div class="result-card primary"><h3>${primaryService.name}</h3><p><strong>相談形式：</strong> ${primaryService.serviceType || ''}</p><p><strong>対応時間：</strong> ${primaryService.hours || ''}</p><p><strong>特徴：</strong> ${(primaryService.features || []).join(' / ')}</p><p>${primaryService.description || ''}</p><p class="notice">${result.notice}</p></div>`;
        resultContainer.innerHTML += primaryHTML;
        if (primaryService.contact && primaryService.contact.startsWith('0')) { contactButtonContainer.innerHTML = `<a href="tel:${primaryService.contact}" class="primary-button">📞 ${primaryService.contact} に電話する</a>`; } 
        else if (primaryService.contact) { contactButtonContainer.innerHTML = `<a href="${primaryService.contact}" target="_blank" class="primary-button">公式サイトへ</a>`; }
        if (result.secondary && result.secondary.length > 0) {
            let secondaryHTML = '<h4>こちらの窓口もご検討ください</h4>';
            result.secondary.forEach(id => {
                const service = counselingServices[id];
                if(service) secondaryHTML += `<div class="result-card secondary"><h5>${service.name}</h5><p><strong>相談形式：</strong> ${service.serviceType || ''}</p></div>`;
            });
            resultContainer.innerHTML += secondaryHTML;
        }
        document.getElementById('restartButton').onclick = () => location.reload();
        document.getElementById('showResultTextButton').onclick = () => {
            let text = `【あなたへのおすすめ】\n${primaryService.name}\n相談形式：${primaryService.serviceType || ''}\n連絡先：${primaryService.contact || ''}\n\n${result.notice}\n`;
            document.getElementById('resultText').innerText = text;
            document.getElementById('resultTextContainer').classList.toggle('hidden');
        };
    }

    // 6. 質問表示とクリック処理
    function handleOptionClick(value) {
        appState.answers[questions[appState.currentStep].id] = value;
        appState.currentStep++;
        if (appState.currentStep < questions.length) {
            renderQuestion();
        } else {
            const result = recommendService(appState.answers);
            displayResults(result);
        }
    }

    function renderQuestion() {
        const questionData = questions[appState.currentStep];
        const progress = ((appState.currentStep + 1) / questions.length) * 100;
        let html = `
            <div class="progress-bar"><div class="progress-bar-inner" style="width: ${progress}%;"></div></div>
            <p>質問 ${appState.currentStep + 1} / ${questions.length}</p>
            <h2 class="question-title">${questionData.question}</h2>
            <div class="options-grid">
        `;
        questionData.options.forEach(option => {
            html += `<button class="option-button" onclick="handleOptionClick('${option.value}')">${option.label}</button>`;
        });
        html += `</div>`;
        document.getElementById('questionSection').innerHTML = html;
    }
       // GASにデータ送信（フォーム経由でCORS回避）
function saveToGAS(answers, recommendation, clickedContact = false) {
    const now = new Date();
    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];

    const data = {
        sessionId: appState.sessionId,
        timestamp: now.toISOString(),
        date: now.toLocaleDateString('ja-JP'),
        weekday: weekdays[now.getDay()],
        time: now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' }),
        urgency: answers.urgency || '',
        symptoms: answers.symptoms || '',
        preference: answers.preference || '',
        timing: answers.timing || '',
        recommendedService: recommendation.name,
        serviceType: recommendation.serviceType,
        contactClicked: clickedContact ? 'はい' : 'いいえ',
        hour: now.getHours()
    };

    submitFormToGAS(data);
    return true;
}

// フォームにデータを埋めて送信
function submitFormToGAS(data) {
    const form = document.getElementById('gasForm');
    for (const key in data) {
        if (form.elements[key]) {
            form.elements[key].value = data[key];
        }
    }
    form.submit();
}
        
    // 7. アプリの初期化
    document.addEventListener('DOMContentLoaded', () => {
        renderQuestion();
    });

    </script>
    
<!-- 非表示フォーム（GAS送信用） -->
<form id="gasForm" action="https://script.google.com/macros/s/AKfycbyA1sOBWKdieibi4Gk40lD-8cN0h_58AAQ0JUwvqFumPQuwf7hf8R3mL1AJ5H3nrA9j/exec" method="POST" target="hiddenFrame" style="display: none;">
  <input type="hidden" name="sessionId">
  <input type="hidden" name="timestamp">
  <input type="hidden" name="date">
  <input type="hidden" name="weekday">
  <input type="hidden" name="time">
  <input type="hidden" name="urgency">
  <input type="hidden" name="symptoms">
  <input type="hidden" name="preference">
  <input type="hidden" name="timing">
  <input type="hidden" name="recommendedService">
  <input type="hidden" name="serviceType">
  <input type="hidden" name="contactClicked">
  <input type="hidden" name="hour">
</form>
<iframe name="hiddenFrame" style="display: none;"></iframe>

</body>
</html>
